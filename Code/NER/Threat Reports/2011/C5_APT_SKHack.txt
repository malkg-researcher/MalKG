SKHackbyan AdvancedPersistentThreat CommandFive PtyLtdSeptember 2011 ABSTRACT This	 document	 summarises the July 2011	 intrusion into SKCommunications which	 culminated	 in the theft	 of	 the personalinformationof	upto	35millionpeople.Itdescribestheuseofatrojanedsoftwareupdatetogainaccesstothetarget	network,	ineffect	turninga security	 practice into a vulnerability.	 It also describes the use of	 a legitimatecompanytohosttoolsusedintheintrusion.Linksbetween this intrusion and other malicious activity	 are identified and	valuableinsights are provided for network defenders. Technical details of malicioussoftwareand	infrastructurearealso	provided. WARNING This	 paper discusses malicious activity	 andidentifies Internet Protocol (IP) addresses, domainnames, and websites that may	 contain malicious content. For safety reasons these locations shouldnot	 be accessed,	 scanned, probed,	 or otherwise interacted	withunlesstheirtrustworthinesscan beverified. SK HACK On 28	 July	 2011 SK Communications announced	 ithad	beenthesubject	ofahackwhichresultedinthetheft	of	thepersonaldetailsofup	to35	millionof	its users.	 The compromised	 details were those of CyWorld and	 Nate users,	 as stored	 in SK1Communications’userdatabases.CyWorld is	South Korea’slargest	socialnetworking	siteand	Nateis	a popularSouth	Koreanwebportal.	Both	servicesare ownedby	SKCommunications.	(Sung.jin,2011) 1CyWorld has	 also expanded to China, Japan, the United	 States,Taiwan,Vietnamand	Europe.(SK	Communications) The sophistication of	 the attack along	 with	 theperiod of time over which	 it	 was planned,	 and	conducted, indicate that	 this attack was likely	 tohave been undertaken by an Advanced PersistentThreat2.	 3Between 18 and 25 July 2011	 the attackers infectedover60SK	Communicationscomputersandusedthem	togainaccesstotheuserdatabases.	The attackers infected	 these computers by	 firstcompromising	aserver,belonging	toaSouthKorean softwarecompany,usedtodeliversoftwareupdates to	 customers (including SK Communications).	 Theattackers modified the server so	 that the SK Communications computers would receive a4trojaned update file when they	 conducted	 theirroutine checks for software updates.	 (Moon.young, 2011)(ESTsoft,	2011)2Foradefinitionoftheterm‘Advanced	PersistentThreat’	refertotheCommandFivepaper‘Advanced	PersistentThreats:ADecadeinReview’	(Command	FivePtyLtd,2011).3 Theterm ‘attackers’ is used in this	 paper to describe boththehackersand	anyonetowhomtheywerereporting. 4Atrojanisadocumentorprogramwhich	appearsharmless	butperformsmaliciousactivitywhenopenedorrun. Such	 routine updates (commonly	 known as‘patches’)areagoodsecurity	practiceastheyofteninclude fixes for security weaknesses identified inthe software.	 Without software updates the SKCommunications computers would	 have beenvulnerable to several other attacks including	 asignificant one which	 was made public in June52011 .	 The security of software updates is usuallytrusted	 implicitly	 and	 the exploitation of	 this trustrelationshipcould	go	undetectedbymanytargets,	asit	didforsometimeby	SK	Communications.Between18	and25	July	theattackersconducted	command and control and monitoring activities ontheinfectedcomputers.	Thisinvolvedtheupload	of	tools,	 conveniently stored on the website of aTaiwanese publishing company	 the attackers hadearlierhacked.	Thenon26 July	2011,	theattackers,	having	 done the necessary	 groundwork,	 proceeded6to	 hack the Nate and CyWorld user databases .(Birdman,2011)(Moon.young,	2011)7Using	 ‘waypoints’ to	 obfuscate the source of	their activities,	 the attackers successfully	 stole thepersonal details of up to	 35 million SKCommunicationscustomersfromtheuserdatabases.	These personal details included	 names,	 phonenumbers,	 home and email addresses, birth dates,gender details,	useridentifiers,	passwordsand,	due8to	 South Korea’s Real Name System which	 was inplaceat	thetime,also	resident	re istrationnumbers.	The passwords and resident	 registration numberswere reportedly encrypted but the other detailswerenot.	(Birdman,	2011)(Hauri.ResponseTeam,2011)(Moon.young,2011)(Jin.woo	Seo,	2011)THE UPDATE SERVERThe update server used	 by the attackers as alaunchpad	 for their attack against SK	CommunicationswasESTsoft’sALZipupdateserver.ESTsoft is	 a large South	 Korean software company5 Avulnerabilityexists	incertainversionsofasoftwareprogramused by SK	 Communications	 (amongst other companies) whichcould allow an attacker to gain control of computers	 if theprogram is	 used	 on them to open a maliciously crafted	 file.(JapaneseITPromotionAgency2011)6 According	 to the Korean National Police Agency the hackercollected information from the infected	 computers	 for up to aweekbeforehacking	thedatabases.(Moon.young,2011)7A‘waypoint’	is	acomputerused	byattackers	as	anintermediarypointtoobfuscatethesourceoftheirhacking	activities.8 UnderSouthKorea’sReal	NameSystem,Koreans	wererequiredto submit their real	 names and	 resident registration numberswhen creating	 accounts	 on any website attracting more than100,000visitors	perday.(TMCnews	2011) and	 ALZip is a file compression and	 archive tooldeveloped	by	thecompany.	ALZip	is	partofatrustedsuiteoftoolsknownasALToolswhichalsoincludesthe antivirus software,	 ALYac.	 The antivirussoftware is	 independent of the rest of	 the suite of	tools.	It	usesadifferentupdateprogram	and	serverto	 the other tools.	 The security	 of ALYac was notcompromisedintheattack.	(ESTsoft,2011)(ESTsoft,	2011)The attackers,	 purportedly using	 Chinese IP	9addresses ,	gained	accesstotheALZipupdateserverviaunknownmeansand	uploadedinstructionstoit.	Then, when SK	 Communications computersconductedtheirroutinecheckforALToolsupdates,the attacker’s instructions on the update serverdirected the computers to download a trojanedupdate from	 the attacker’s Content Delivery10Network (CDN) instead of	 the legitimate updatefromESTsoft’sCDN.(ESTsoft,	2011)The trojaned	 update exploits a software11vulnerability in the ALTools Common ModuleUpdate Application (ALCMUpdate.exe) .theprogram used to conduct the routine checks forALTools software updates.	 This vulnerability	12allowed	 a malicious Dynamic Link Library	 (DLL)filetobeloaded	insteadofthelegitimateDLLupdatefile(ALAd.dll),	therebyenablingmaliciouscodetoberun and	 malicious software (malware) to	 beinstalled	oncomputerswhich	requested	theupdate.	Over 60	 SK Communications computers werecompromised via the trojaned	 update. (ESTsoft,2011)(EDaily,	2011)(ESTsoft,	2011)The attackers are believed to have designated	targetsforinfection,sothat	thetrojaned	updatewasonly	 delivered	 to SK Communications computersand	 not to	 other computers requesting	 the same 9 According	 to South	 Korean news	 outlets	 the attackers	 usedChineseIP	addresses.(Goodin,2011)10 A CDN is comprised	 of multiple servers	 which	 are used todistribute software downloads, thereby balancing	 the load	 andpreventing outages	 due to individual	 servers becomingoverloaded.11Asoftwarevulnerabilityexistedintheupdateprogramused	byseveral	 tools in the ALTools suite. The vulnerability allowedarbitrarycodetobeexecutedbutcouldonly	beexploitedfromtheactualupdateserveror,ifacomputercouldbedirectedtoit(eg.bymodifying	thehostfile	onthecomputerorviaDNShijacking),afake	updateserver.Apatch	forthevulnerabilitywas	releasedon4	August2011.(ESTsoft2011)(ESTsoft,2011)12According	toMicrosoft,aDLLisalibrarythatcontainscodeanddatathatcanbeusedbymorethanoneprogramatthesametime.(Microsoft2007)1. Attacker 18credentials such	 as usernames and	 passwords .	(Birdman,2011)(Moon.young,	2011)Theattackeralso	installed	themalwareused	toaccess the user databases on at least one of theinfected computers.	 The malware was named	‘nateon.exe’19and	 was also	 hosted	 on the same20toolbox,	 along	 with another file named ‘rar.exe’ .	(Birdman,2011)(Hauri	.ResponseTeam,	2011)21Staticanalysis ofthefile‘rar.exe’indicatesit	is	a modified version of	 the WinRar22command lineprogram .also named ‘rar.exe’. The file may	 havebeen used in the attack to create or open archivefiles.	 The modifications made to	 the programremove the program	 properties from display,	presumably	 to disguise the true nature of the file.This	issomewhatredundantinthisinstancethough,given the file name indicates the nature of	 theprogram. THE TOOLBOXThe files downloaded onto the infected SK	Communicationscomputerswerereportedly	hosted	23at‘www.cph.com.tw/act’ –awebsite belongingtothelar eTaiwanesepublishingcompany,	CiteMedia24Holding Group .	 It	 is	 likely	 the company’swebserver was compromised	 unbeknownst	 to itsowner and used	 by	 the attacker as a toolbox fromwhich	to	downloadmalicious filesandhacker toolsontotargeted	computers.The website ‘cph.com.tw’ is assumed to	 havebeen running	 on an Internet	 Information Services(IIS)webserveratthetimetheserverwashacked25.	IIS runs on the Microsoft	 Windows operatingsystem, indicating	 the compromised server was 18 Antivirus software detects	 the file as‘Heuristic.BehavesLike.Win32.PasswordStealer.H’	 and‘HKTL_NETVIEW’.(HispasecSistemas,2011)19The file named ‘nateon.exe’ is 166912 bytes and	 has a SHA1hash of F84C D73D ABF1	 8660	 7F98	 6DF9	 8C54 02A5	 7BB58AD1.	 It is detected	 as ‘Backdoor.Sogu’ by Symantec antivirussoftware.(JSUNPACK2011).(HispasecSistemas,2011)20Thefile	named‘rar.exe’is	337920bytes	and	has	aSHA1	hashofE87C 3ACB A599	 5E01 7AD3	 1B29 A5E2 FE36 3ED4 D9EB.(JSUNPACK	2011)21Static analysis	 refers to analysis	 of a program’s code todetermine its functionality, as	 opposed	 to dynamic analysis inwhich	aprogramisexecutedtodetermineitsbehaviour.22 WinRARis	apopulararchivingandcompressiontool.23The files	 ‘nateon.exe’, ‘rar.exe’ and	 ‘x.exe’ were hosted at‘www.cph.com.tw/act’.(Birdman,2011)24 CiteMediaHolding	Grouppublishes	over20millionmagazineissueseachyearinTaiwan.(Novell2011)25 An archived error page shows	 the ‘cph.com.tw’ website wasrunning	onanIISserverinlate2010.(TheInternetArchive2010) likely	 running	 Microsoft Windows. There are anumber of	 known vulnerabilities for both	 IIS	 and	Microsoft	 Windows	 which	 potentially	 could	 havebeen exploited and resulted	 in the compromise ofthewebserver26. THE DATABASE ACCESSAfter the week collecting information from theinfected computers the attackers were ready toaccessthedatabases.On26July	2011,	theyusedtheinformation they	 had	 gathered,	 along	 with amaliciousprogram	named	‘nateon.exe’,	to	accesstheNate and CyWorld	 databases.	 The theft	 ofinformation continued into the following day .27July	 2011. (Birdman,	 2011) (Moon.young,	 2011)(Hauri.ResponseTeam,	2011)The personal information extracted from thedatabaseswaspurportedly	sentviaawaypoint	toaChinese IP address where the hacker received theinformation.	 The waypoint used purportedly	belonged	 to a company	 based	 in Seoul’s Nonhyeonneighbourhood.	(Moon.young,	2011)The South Korean waypoint	 may	 have beenlocated	 by the malware using	 the callback domain‘ro.diggfunny.com’which	wasreportedly	associatedwiththeleakof	informationfrom	thedatabases27.	It	has not,	 however,	 been confirmed	 whether,	 at thetimeof	theattack,	thiscallbackdomainpointed	to	anIP	addressbelonging	toaNonhyeon.based	company. 26 Both	 the Microsoft Security TechCenter and the US NationalVulnerability Database make available a comprehensive list ofMicrosoft Windows and	 IIS vulnerabilities. (Microsoft n.d.)(NationalInstituteofStandardsandTechnologyn.d.)27 According	toSamsung	IDCtheIPaddress	116.127.121.109	wasassociated with the leak of database files from Nate. (SamsungIDC2011)10026210/10070910: 31 9C 6C 4C 10026220/10070920: 6E 61 74 65 10026230/10070930: 63 6F 6D 00 10026240/10070940: 00 00 00 00  B9 3A 10 00 6F 6E 2E 64 00 00 00 00 00 00 00 00  E8 03 00 00 75 61 6D 6C 00 00 00 00 00 00 00 00  01 00 50 00 69 76 65 2E 00 00 00 00 00 00 00 00  1.lL.:..è.....P. nateon.duamlive. com............. ................  …  100268A0/10070FA0: 00 00 00 00 100268B0/10070FB0: 00 00 00 00 100268C0/10070FC0: 76 63 66 73 100268D0/10070FD0: 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 77 69 6E 73 00 00 00 00 00 00 00 00  ................ ............wins vcfs............ ................  …  10026930/10071030: 00 00 00 00  00 00 00 00  00 00 00 00  ............  FIGURE 2.EXCERPTSFROM THE ‘NATEON.EXE’CONFIGURATIONBLOCK THE DESTORY RAT Structure	and BehaviourThemaliciousprogramnamed‘nateon.exe’installsaRemote Administration Tool (RAT)	 named‘winsvcfs.dll’.	Itmodifiesthesystemregistry	insuch	away	that	theRAT	getsexecuted	asaservicebythe28trusted	 process ‘svchost.exe’ each	 time thecomputer is started.	 Once ‘winsvcfs.dll’ is	 installed,	‘nateon.exe’ 30is deleted. Both	 ‘nateon.exe’29 and	‘winsvcfs.dll’ are now	 detected	 by	 some antivirussoftware.	Static analysis	 of	 the malware reveals aconfiguration block.	 This configuration blockcontainsthenameof	theDLLfilewhich‘nateon.exe’ is	 to create. In this instance,	 the configured named	was ‘winsvcfs.dll’,	asshown in Figure2.	Due to	thenamebeing	configurable,	theRAT	willnotalwaysbecalled	 ‘winsvcfs.dll’.	 The configuration block also	contains a callback domain and port for themalware’s command	 and	 control communications.	The callback domain is configured to	 be‘nateon.duamlive.com’and	theportis	configuredtobe80	(50inhexadecimal),	also	showninFigure2.If	 no	 configuration is specified, the malwareuses default	 values instead.	 The default callbacklocation hardcoded into	 the malware is the privateIP	 address,	 192.168.0.200.	 This	 address is	 not 28Theprocess‘svchost.exe’	is	agenerichostprocess forserviceswhich	runfromDLLs.(Microsoft,AdescriptionofSvchost.exeinWindowsXP	ProfessionalEdition2007)29On 29 July	 2011, 23 of 43 antivirus products	 tested detecte‘nateon.exe’	 as	 malware, as	of19August 2011 this	 number hadincreased to 36 of the 43. (Hispasec Sistemas 2011) (HispasecSistemas	2011)30 As	 of 6 September 2011, 34 of 44 antivirus products testeddetected‘winsvcfs.dll’	asmalware.(HispasecSistemas2011) routableonthe Internetand	suggeststheattackersrely	 on the configuration instead of the hardcoded	callbackaddress.According to information contained within‘nateon.exe’, the malware used	 in the SKCommunications hack was compiled	 from	 sourcecode on 27 September 2010 at	 01:17.04 .over 6months before the attack.	 The configuration blockwaslikely	insertedinto	thebinary	afterthisdateasthe callback domain was not	 registered	 until May	2011.	Thismayindicatethat	theRAThasbeenusedinotherattacksbutwithdifferentconfigurations.If	31the previously	 identified ‘Backdoor.Sogu’ is	 aversion of the malware, other callback domainspreviously	 configured may	 include those known tobeused	by‘Backdoor.Sogu’.Thesedomainsinclude‘bbs.afbjz.com',	 ‘newhose.ntimobile.com', and‘www.adv138mail.com'32.The RAT	 has many	 different	 capabilities andruns	onmultipleversionsoftheMicrosoft	Windows	operating system.	 The RAT's behaviour changesslightly	depending	onwhichversionof	theWindows	operating system it is installed	 on and which	modules are installed.	 Modules used by	 the RAT	deployed to	 the SK Communications networkinclude: 31 Symantec antivirus software detects	 ‘nateon.exe’	 as'Backdoor.Sogu'. The malware described by Symantec exhibitssimilarbehaviourto'nateon.exe'	butisasmallersize.(Mullaney,2011)32 In addition to being	 used	 by ‘Backdoor.Sogu’, the callbackdomain'www.adv138mail.com'wasused	byaPoisonIvyRATinaJuly	 2011 socially engineered email campaign which	 targetedexperts	ontherelationshipoftheUnited	Stateswith	Japan,Chinaand	Taiwan.(Parkour,2011)• advapi32.dll,• cryptbase.dll,• gdi32.dll,• iphlpapi.dll,• kernel32.dll,• mpr.dll,• msvcrt.dll,• ntdll.dll,• odbc32.dll,• ole32.dll,• psapi.dll,• sfc.dll,• shell32.dll,• shlwapi.dll,• user32.dll,• userenv.dll,• version.dll,• wininet.dll,• ws2_32.dll,• wtsapi32.dll.Of note,	 the module ‘odbc32.dll’ is	 used	 in theaccess of	 databases. The RAT	 uses a number of33Standard Query Language (SQL) functions whichare accessed (or more technically,	 dynamicallyimported)	asthesoftwareruns.	Theseinclude: • LAllocHandle,• LColAttributeW,• LDisconnect,• LDriverConnectW,• LExecDirectW,• LFetch,• LFreeHandle,• LGetData,	• SQLGetDiagRecW,• SQLMoreResults,	• LNumResultCols,	• SQLSetEnvAttr.Thesefunctionswould	havebeenutilisedby	theattackertocommunicatewith	theNateandCyWorlduser databases and thereby,	to obtain thepersonaldetails.The RAT can not only access and query	databases but	 can also	 enumerate the networks towhich	 the infected	 computer is	 connected,	 set	 up	network connections, modify	 the registry, lock theworkstation'sscreen,controlprocessesandservices 33 SQL instructions	 are used	 toquery certaintypesof databasesand	obtaininformationfromthem. running on the computer, download files, createfiles,	takescreenshotsand shutdown,	rebootor log	out	 of the computer. The RAT	 has four differentoperating modes; SMI (Install),	 SMU (Uninstall),SMRAC (Run as Console) and SMRACU (Run	 asConsoleUser).	(Hauri.ResponseTeam,	2011)Acompletelistofstringsobtainedthroughstaticanalysis of	 the malware is provided in Annex	 A.These strings give additional insight	 into	 the RATand	itsbehaviour.	Ofnote,auniquestringispresentwhich	 may	 be used	 to	 associate ‘nateon.exe’ withother malware.	 This	 string is	 ‘CONFIG DESTORY!’ and	 is	 contained	 within the malware in anobfuscatedform.	Thestring	is	displayed	inapop.up	windowifanintegritycheckthemalwareperformsonitsconfigurationfails.The RAT	 employs some basic obfuscationtechniques.	 All strings are obfuscated in memory	and	 only	 decoded	 when they	 need	 to	 be used,thereby	 making static analysis	 more difficult.	 Inaddition,	 unnecessary	 operations are inserted	 atfrequent	intervalsthroughoutthecode.	Theprolificuse of	 unnecessary	 operations is likely	 to	 makereverse engineering more difficult	 and	 potentially34indicates that	 the malware is	 polymorphic .	 TheRAT,	whileinsomewayssophisticated,	stillhidesinplainsight–limiting	itsscopeforobfuscation. CommunicationsThe RAT attempts communications to	 a commandand	controlserver locatedusing	acallbackdomain.	It also	 creates a raw socket	 and binds it to	 theinfectedcomputer’slocalIPaddress(asassignedtothecomputer’snetworkinterfacecard).	This	is	not,	however,	fortheRAT	to	acceptinbound	connectionrequests. The socket is	 configured by the RAT	 insuch	away	thatit	actsasapacketsniffer,whereby,theRATreceivesacopy	ofallinboundandoutbound	network traffic on the bound	 interface. As well asenabling	deepinspectionof	thisnetworktraffic,	thecapability could	 allow the RAT	 to	 passively	 receivecommands	onany	portusing	anyprotocol.Before attempting	 communications to	 thecommand	 and	 control server, the malware checksfor network connectivity.	 It does this by using	 the 34 Polymorphicprogramscanbemodified(ormodifythemselves)tohaveadifferentfilehash	and/orsizewhileretainingthesamefunctionality. This facilitates code reuse by making signaturebased	detectionmoredifficult. legitimate Microsoft Windows domain‘download.windowsupdate.com’. This legitimatedomain is hardcoded	into the malware but may	 beoverridden by modifying the malware’sconfiguration.Having	 determined	 there is	 networkconnectivity, the malware establishescommunications wit3h5 the callback domain‘nateon.duamlive.com' onTCP	port	80	(configuredas noted	 previously).	 Communications occur overtheHyperText	Transfer Protocol (HTTP)	protocol – a protocol commonly	 used	 on TCP port 80 forwebsite browsing.	 The malware appears to	 beproxy.aware and capable of communicating via awebproxy. 36Thefollowing	malformed	user.agent is	present	in the HTTP requests (spaces shown here as ‘·’):‘Mozilla/4.0·(compatible;·MSIE·6.0;·Windows·NT·5.1;SV1;’.This	 user.agent	 is	 consistent	 with	 that whichmay	beexpectedfromauserrunningversion6.0of	theMicrosoft	InternetExplorerwebbrowserontheMicrosoftWindowsXP	operating	system,exceptthat	it	 is	 missing	 a closing	 bracket after the lastsemicolon and a space after the second	 to	 lastsemicolon.This	malformed	user.agent	is	hardcoded	and	 can be used	 as a signature to detect HTTPcommunicationsproduced	by	themalware.	Four custom	 headers are also	 present in theHTTP requests:	 ‘X.Session’, ‘X.Status’,	 ‘X.Size’,	 and‘X.Sn’. The file path	 requested	 is	‘/update?product=windows’.	 These custom headersand	 the file path	 may	 also be used to	 develop	signatures for detection of	 the RAT’scommunications.Once the malware successfully	 contacted	 thecommand	 and	 control server, the attacker wouldhave been able to give it instructions to access theNateandCyworlddatabasesandtosenddatafromthembackto	alocationtheattackercould	access.The name of	themalwareand	 the nameof	 theselected	 callback domain were presumably	 chosen 35Multiplesourcesconfirm themalware used	inthehack	calledback	 to 'nateon.duamlive.com'. (Samsung	 IDC 2011) (Birdman,2011)36 User.agents	 are used in HTTP	 communications	 to tellwebservers	 which operating	 system and web browser theirclientsareusing,sotheycanservecompatiblewebpages. by	theattackersto	disguisethem	asbeingassociated	with NateOn .an Instant	Messaging	 Serviceowned	b SK Communications. Legitimate files developedby	SK	Communicationsarealso	knownby	thename‘nateon.exe'37. THE MALICIOUS INFRASTRUCTURECallback domains are translated to IP addresses38using	 the Domain Name System	 (DNS) protocol.	This	translatesthedomaininto	auniqueaddressonthe Internet which	 infected computers can use tolocate and communicate with a command	 and	control server. Command and control servers aretypically	 more resource intensive to	 set up	 andmaintainthancallbackdomainswhich	may	beused	to	 direct communications to them.	 It is notuncommon for multiple domains to	 identify thesamecommand	and	controlinfrastructure.In	late July	 2011, at the time of the attack,	 thecallback domain ‘nateon.duamlive.com’ pointed totheSouth	Korean IPaddress 121.78.237.135 butat	the time of writing points to	 local loopback IP39address127.0.0.1 .	Attackersquitecommonly	point	a callback domain to a local loopback IP	 addresswhen they	 do	 not	 have any	 instructions for theinfectedcomputersusing	that	domain.	the computers from	 unnecessarily	 conThispreventsacting	 thetattacker’s command	 and control infrastructure.	Attackers also	 quite commonly	 point a callbackdomain to	 a local loopback IP address when theywant to protect their command and controlinfrastructurefromdetection.At	 the time of	 the attack,	 the callback domain‘ro.diggfunny.com’ pointed to	 the South	 Korean IP	address 116.127.121.109. This IP address is in the40sameIP	addressrange (116.127.0.0/16) astheIPaddressused	by	theALToolsrelated	command	andcontrol server (IP	 address 116.127.121.41).	 The IP 37 Differentversions	ofalegitimatefile	named	'nateon.exe'	exist.Thesefilesareassociated	with	theNATEONUpgraderdevelopedbySKCommunications.(MisterGroupn.d.)38 DNS is	 fundamental	 on the Internet. It is a form of directoryassistancetohelpcomputers	communicatewithothercomputers.Itsuseis	analogoustoapersoncalling	directoryassistancetofindoutwhatphonenumbertodial	tospeak	toacertainperson.39 AlocalloopbackIP	addressisanaddress	whichisnotInternetor Intranet routable, ie. it can not be used by a computer tocommunicatewith	anothercomputer.Whenacomputerattemptsto communicate with	 a local loopback	 IP	 address, itcommunicates	with	itself.40The IP address	 range 116.127.0.0/16	 is the Classless Inter.Domain Routing	 (CIDR) representation of IP addresses116.127.0.0	through	116.127.255.255. address range is	 allocated to	 the South	 Korean ISPHanaro	Telecom.A portion of	 the IP	 address range appears to	have been assigned by	 Hanaro	 Telecom	 to a South	Korean web hosting	 company.	 It	 is	 not knownwhetherthetwo	IP	addressesused	bytheattackersfall within the range used by the webhosting	c any.	 It	 is	 also	 unconfirmed whether thatcompany is based in Nonhyeong .the geographicregion of the company that hosted	 the waypointusedintheattack.If	theIP	addressesused	by	theattackers intherange 116.127.121.0/24 were assigned to the webhosting company,	 it	 is	 possible the attackerspurchased	 webhosting services through thecompany	tohost	theircommandandcontrolserversinsteadofcompromising	legitimateservers.OtherIP	addresses in the range are also	 associated	 with41malware but	 that	 malware may	 not be related	 inany	 way	 to the SK Communications hack or theattackersinvolved	inthehack.In	 late July	 2011,	 at around	 the time of theattack,	 the callback domain ‘update.alyac.org’pointed to	 the South Korean IP address202.30.224.240.	 As at	 the time of writing, thedomain now	 points to	 the legitimate Google IPaddress 8.8.8.8. This	 is	 not an indication that	 theGoogleIPaddressiscompromised,andtheGoogleIPaddressisunlikely	to	becompromised.	The Google IP	 address is	 likely	 only	 used toindicatethattheattackerhasnoinstructionsforthemalwareortoinstructthemalwareto	continuewithpre.programmedbehaviour.Themalwarelikely	haslogic	builtinwhichpreventsit	from	communicating	with the Google IP address.	 Use of	 the Google IPaddress would	 likely	 achievetheattacker’s desiredoutcomeinasimilarwaytouseof	alocalloopbackIP	address.	It would,	however,beless likelyto	flag	42theactivityto	networkdefenders .	Itisalso	possibletheGoogleIPaddressisusedto	channelcovertcommunicationsto thecommand 41 The command	 and control servers	 of dozens of pieces	 ofmalware have used IP addresses within the IP address	 range116.127.121.0/24.(Malc0de.comn.d.)42 Use of legitimate IP addresses	 in combination withpreprogramed	logicto preventacommunicationwith	commandand	 control	 infrastructure is a much	 less common indicator ofmalicious	activitythanuseofalocalloopback	IP	addressforthesamepurpose. 43and	controlserverovertheDNS	protocol ,	ineffect,	using	 Google as a voluntary	 waypoint	 without	actually	compromisingGoogle’sinfrastructure.	Each	of	thethreecallbackdomainshasaTime.44To.Live (TTL) of 30 minutes, allowing theattackers to rapidly	 change the command andcontrolserverpointed	toby	thecallbackdomain. Registration InformationThe domain ‘duamlive.com’ was registered on 21May	2011.Itwasregisteredby	a‘Guangming	Wang’.	There is a large number of	 domain registrations(approximately	 400) associated with ‘GuangmingWang’,	 possibly indicating that	 the domains wereregisteredbyanintermediary.	The domain ‘alyac.org’ was registered on 24September 2010.	 The domain registrationinformation is	 almost identical to that	 of	 thelegitimateESTsoftdomain‘alyac.com’.	Thedomainisnot,	 however,	 associated	 with	 the ALYac antivirussoftwareanddoesnotappearto beassociatedwith	ESTsoft at	 all.	 The title of the website previously	hosted at ‘alyac.org’ was associated with finance,insurance and	 cell phones and	 not antivirussoftware45.At	 the time of writing, the malicious domain‘alyac.org’pointstotheGoogleIP	address8.8.8.8but	previously	 pointed to	 South Korean IP	 address222.122.20.241.	 Other probable malicious domainsfollowing	 a similar pattern to	 ‘alyac.org’ (whereby	they	 disguise themselves as being	 associated	 withlegitimatesoftwarecompanies)havealso	pointed	tothesameSouth	KoreanIPaddress.	Theseincludethedomains ‘trendmicros.net’, ‘nprotects.org’ and‘bomuls.com’.	The domain ‘trendmicros.net’ was purportedly	registered by Trend Micro	 Inc.	 The registrationdetailsarealmostidenticalto	thatofthelegitimatedomain ‘trendmicro.com’.	 The domain,	 however,	appears to	 have nothing	 to do	 with	 the securitycompany.	 The malicious domain ‘nprotects.org’ issimilar to	 that of	 the legitimate security	 company43 Themalwarecoulduseasimilartechniquetosoftwaresuch	asiodine.(Kryo,2010)44TheTTLofadomaininaDNSrecord	referstothedurationforwhich	theDNSresult	canbecached.45Awebpagepreviouslyhostedat'alyac.org'hadatitleof'CashAdvance |	 Debt Consolidation |	Insurance | Free CreditReport |CellPhonesatalyac.org’.(DomainTools,LLC,2011)nProtect(‘nprotect.com’)butagain,doesnotappearto	beassociated	withthecompany.	Thedomainhaspreviously	beenassociated	withmalwareknownas‘Trojan.Win32.Generic’ .	 Similarly	 the domain‘bomuls.com’ is not 4d6issimilar to that of thelegitimatesoftwarecompany	whosewebsiteresidesat‘bomul.com’.(ETnews,	2011)ThedomainsreferencedabovearesummarisedinTable1.	 DOMAIN SUBDOMAIN IPADDRESS(ES) DUAMLIVE.COM  127.0.0.1  NATEON.  121.78.237.127.0.0.1 135	(KR)*  FR.  121.78.237.127.0.0.1 135	(KR)*  ALYAC.ORG  222.122.20.241	(KR)8.8.8.8(US)*  UPDATE.  202.30.224.240	(KR)8.8.8.8(US)*  PATH.  8.8.8.8(US)  WWW.  8.8.8.8(US)  NPROTECTS.ORG  222.122.20.241	(KR)  FILE1.  222.122.20.241	(KR)  PC.  220.90.209.157	 KR222.122.20.241	(KR)*  TRENDMICROS.NET  222.122.20.241	(KR)  DOWNLOAD.  222.122.20.241	(KR)  BBS.  222.122.20.241	(KR)  BOMULS.COM  66.249.89.222.122 104(US).20.241	(KR)98.126.8.230	(US)*  DOWNLOAD.  222.122.20.241	(KR)  FORUM.  222.122.20.241	(KR)  *Indicates	IPaddressassignedattimeofwriting.TABLE 1.SUMMARYOFREFERENCEDDOMAINS 46 Malwaredetected	as	‘Trojan.Win32.Generic’	inMay2011usedthecallback	domain‘pc.nprotects.org’.(GFISandBox,2011) The domain ‘diggfunny.com’ was registered	 on14April2011bya‘LeeCooper’.	Thesameregistrantdetailswereused	toregisterseveralotherdomains.	These domains include ‘edsplan.com’, ‘ezxsoft.com‘,‘finalcover.com’,	‘mindplat.com’,	‘projectxz.com’,	and‘soucesp.com’ .all of which were registered on 14	April 2011. The domains ‘daumfan.com’ and‘natefan.com’ were also	 registered by ‘Lee Cooper’,	but	 on 25 July	 2011, the day	 before the hackingoperation against	 the Nate and CyWorld	 userdatabases. The same registrant details werepurportedly	 used to register an additional sevendomains.	 Each	 of	 these domains has a TTL of	 30	minutes.	(DomainTools,	LLC,	2011)At	 the time of writing none of the abovedomains registered	 by ‘Lee Cooper’ point to	 amalicious IP address.	 The domain ‘natefan.com’points to	 the Google IP	 address 8.8.8.8,47‘daumfan.com’ points to	 the Enom	 Inc IP	 address8.5.1.42, ‘finalcover.com’ points to the private IPaddress 192.168.10.132 and	 none of	‘diggfunny.com’, ‘ezxsoft.com’, ‘edsplan.com’,	‘mindplat.com’, ‘projectxz.com’ or ‘soucesp.com’currently	 point	 to	 an IP address.	 This suggests thedomainsarenot	currently inuse,	however,	atleast	one subdomain appears to	 be in current use asshowninTable2. 47 Enom Inc is	 a legitimate domain name registrar used	 by theattackers	toregisterdomainnamesand	alsotohostwebpages. DOMAIN SUBDOMAIN IPADDRESS(ES) DAUMFAN.COM  8.5.8.51.8(US).1.42(US)*  WWW.  8.5.8.51.8(US).1.42(US)*  DIGGFUNNY.COM  8.8.8.8(US)  RO.  116.127.121.109	(KR)  WWW.  8.8.61 8.8(US).19.250.219(TH)  EDSPLAN.COM  64.74.223.10(US)  ITT.  127.0.0.1  EZXSOFT.COM  BBS.  202.30.224.240	(KR)8.8.8.8*(US)  FINALCOVER.COM  192.168.10.132*  I.  69.197.132.127.0.0.1 132	(US)*  T.  218.213.229.69 HK218.213.229.68(HK)*  MINDPLAT.COM  64.74.223.48(US)  CACHE.  8.8.8.8(US)  NATEFAN.COM  8.8.8.8(US)  PROJECTXZ.COM  8.5.1.11(US)  ITT.  202.181.170.67(HK)8.8.8.8(US)*  SOUCESP.COM  61.82.71.127.0.0.130(KR)  *Indicates	IPaddressassignedattimeofwriting.TABLE 2.DOMAINSREGISTEREDBYLEECOOPERSeveral of the domains registered by ‘LeeCooper’ previously	 pointed	 to webpages.	 Thedomain ‘mindplat.com’ previously	 pointed	 to anEnomInc.serverwhich	hosteditswebpage.Thetitleand	meta descriptionof	the‘mindplat.com’websiteis	almost	 identicaltothatof	the ‘alyac.org’website.Both	websites followthe templateshownin Figure3.	Thesametemplatehasalso	beenusedforseveralother webpages and may merely	 be a templateprovided by a service provider used	 by	 theregistrants.The domains ‘natefan.com’ and ‘projectxz.com’also	previously	pointedtowebpages.Thewebpageswere similar to	 the ‘mindplat.com’ and	 ‘alyac.org’web es but with different text.	 Again, thesewebpagesusethesametemplateasotherwebpagesand	may	merely	beprovided	by	aserviceprovider.The presence of	 these webpages may	 indicate anattempt	 by	 the attackers to	 make the maliciousdomainsappearmorelegitimate. Title Cash Advance | Debt Consolidation | Insurance | Free Credit Report | Cell Phones @ domain Meta Description Find Cash Advance, Debt Consolidation and more at domain. Get the best of Insurance or Free Credit Report, browse our section on Cell Phones or learn about Life Insurance. Domain is the site for Cash Advance. FIGURE3.EXAMPLEOFWEBPAGE TEMPLATEUSED SIMILARITIES TO OTHER MALWAREAs previously	 discussed,	 the domain‘ro.diggfunny.com’ is	 associated	 with	 maliciousactivity. The domains ‘cache.mindplat.com’ and‘bbs.ezxsoft.com’ are also	 known to	 be associated	with malware. The first	 is listed	 as a maliciousdomain48and	 thesecond	 was used	as a callbackdomain by	 malware known as49‘Trojan.Win32.AgentBypass’ .	 The domain‘bbs.ezxsoft.com’ also	 previously	 pointed to thesame South	 KoreanIP	addressas ‘update.alyac.org’ (IP	address202.30.224.240),furtherlinking	it	totheattackers responsible for the hack into SKCommunications.Even if	 ignoring	 the connectionthey both	haveto	thedomain‘alyac.org’,	thetwo	piecesofmalwarenamed ‘Trojan.Win32.Generic’ and	‘Trojan.Win32.AgentBypass’ respectively (earlierreferenced)arestilllinked.Both	piecesofmalware50create a uniquely	 named directory ,	 as do	 at least	three other pieces of	 malware (summarised	 inAnnex	 B).	 This	 further links the domains‘nprotects.org’ and	 ‘ezxsoft.com’, and	 suggests thismalware, along	 with the callback domains,	 may bepart	 of	 a broader,	 concerted	 effort	 by the sameattackers. 48 The domain 'cache.mindplat.com'	 is	 listed	 alongside'ro.diggfunny.com'	 in a list of malicious	 web addresses.(CEOinIRVINE2011).49Malware detected	 as	 'Trojan.Win32.AgentBypass'	 in mid July2011 used the callback domain 'bbs.ezxsoft.com'. (GFI SandBox2011)50 Malware analysis reports indicate both	 pieces	 of malwarecreateadirector named	‘03a075fb70d5d675f9dc26fc’	insidethesystem directory and	 a subdirectory named	 ‘update’. (GFISandBox2011)(GFISandBox,2011)27 September 2010 The Destory RAT is compiled. 21 May 2011 The domain 'duamlive.com' is registered. .‘trendmicros.net’instead	of	‘trendmicro.com’,‘nprotects.org’insteadof	‘nprotect.com’and‘bomuls.com’instead	of‘bomul.com’. • Eventhoughitisrelatively	easy	to	create new	infrastructure,	attackerssometimes reuseinfrastructure.	Forexample,	thedomains‘bbs.ezxsoft.com’and‘update.alyac.org’bothpreviously	pointedto	IPaddress202.30.244.240,	and‘alyac.org’,	‘trendmicros.net’,‘nprotect.org’ and	‘bomuls.com’allpointedto	IPaddress 222.122.20.241. • TheTTLofdomains(inDNSrecords)controlled	byattackersareoftenset	tolowvalues(such	as30minutes)allowing	theattackersto	rapidly	changethecommand	and	controlserverpointedto	byacallbackdomain.This	facilitatesrelatively	uninterruptedaccesstoatarget	when command	and	controlinfrastructure becomesblockedoris	otherwise unavailable. • Theuseof	legitimatedomainsformalicious purposes,	familiarwords	indomainnames and	ofnon.maliciousIP	addressesinDNS	records	formaliciousdomains,	canmakedetectionofmaliciousactivity	moredifficultand	causenetworkdefendersto	dismiss maliciousactivity	(innetwork/system	logs	orIntrusionDetectionSystem	alerts,inparticular)aslegitimate. • AddingmaliciousIP	addressesanddomains to	blacklistscanhelp	prevent	malicious activity,however,attackerscanrespond	by	merely	using	alternateinfrastructure and/orcallbackdomains. • Domainsand	IPaddressesmay	have legitimatepurposestoo	andblacklisting	themmay	also	blocklegitimatebusiness.	Blacklistsshould	bereviewedperiodically	to	ensurethey	arenot	blocking	legitimatebusinessunnecessarily.• Whitelistsaregenerally	much	more effectivethanblacklists,	however,even whitelistscanallowmaliciousactivityto occurto	legitimatesitesthathavebeen compromised.	Forexample,asagood	security	practice,	mostsystem	 administratorswould	haveallowed	access to	theALZipupdateserveriftheyhad	ALZip	softwareinstalledontheirnetwork.	Similarly,	ifawhitelistwereemployedon thetargetednetworkbutusershadalegitimateneedtoaccessthewebsiteof	the Taiwanesepublishingcompany,	theattackerwould	likely	stillhavebeenableto accesstheirtoolbox. • Usersand	networkadministratorsneedtocontinually	reassesswhoand	what	they trust	ontheInternetgiventhat	trust	relationshipscanbe,	andincreasingly	are,exploitedformaliciouspurposes. DISCLAIMER Machinetranslationsoftwarehasbeenheavily	relied	onthroughout	the development of this paper.	 While data has been verified	 againstmultiple sources,	 where possible, Command Five Pty Ltd does notguarantee the veracity	 of	 sources or the accuracy	 of	 translation andinterpretation.	 Command	 Five Pty	 Ltd	 reminds readers to	 exercise caution when visiting	 untrusted	 websites and/or opening untrusteddigital documents.	 Command	 Five Pty Ltd does not warrant that thewebsitesreferenced	inthispaperaretrustworthy. REFERENCES Birdman.(2011,July	31).Xecure Lab	 Blog.	RetrievedAugust	12,	2011,	fromhttp://blog.xecure.lab.com/2011/07/2500.htmlCEOinIRVINE.	(2011,	August17).	Information Security & US 	&	 Life	 & Love	& Fashion & Hacking & Passion.	Retrieved	September13,	2011,	from	http://hack3r.tistory.com/tag/Malware CommandFivePty	Ltd.	(2011,	June).Advanced Persistent Threats: A	 Decade	 in Review. Retrieved	September24, 2011,	fromCommand	FivePty	Ltd:	 http://www.commandfive.com/papers/C5_APT_ADecadeInReview.pdf DomainTools,	LLC.	(2011).AlYAc.org .Al	 Y Ac .Screenshot History.	Retrieved	September08,2011,from	 DomainTools:	http://www.domaintools.com/research/screenshot.history/alyac.org DomainTools,	LLC.	(2011).Reverse	 Whois Lookup | Domain Ownership Search	 | Domain Tools.	RetrievedSeptember22,	2011,	from	DomainTools:	http://www.domaintools.com/research/reverse.whois/?all[]=leecooper%40korea.com&none[]= EDaily.	(2011,	August	11).	Nate	hack	 related. RetrievedSeptember14,	2011,	fromEDaily	KoreanNews: http://www.edaily.co.kr/news/NewsRead.edy?SCD=DC16&newsid=02056566596346336&DCD=A01405&OutLnkChk=Y ESTsoft.(2011,	August	04).ESTsoft apology for	ALTools	 security vulnerability. RetrievedSeptember14,2011,from	 ESTsoftBlog:	http://blog.estsoft.co.kr/138ESTsoft.(2011,	August	05).ESTsoft news release	 with respect to	 ALTools	security	 vulnerability. RetrievedSeptember19,	2011,	from	ESTsoftBlog:	http://blog.estsoft.co.kr/139ESTsoft.(2011,	August	11).Police release	 interim results on Nate	 hack. RetrievedSeptember14,2011,from	 ESTsoftBlog:	http://blog.estsoft.co.kr/143ESTsoft.(2011,	August	04).Urgent security patches for public	ALTools products. RetrievedSeptember20,	2011,	fromALToolsAnnouncements:	http://www.altools.co.kr/Plaza/Notice_Contents.aspx?idx=828 ETnews.	(2011,	August05).	ETnews .Nate	hack, planned since last year? Retrieved	August12,2011,	from	 http://www.etnews.com/news/print.html?id=201108050128GFISandBox.(2011,May	30).GFI SandBox Malware Analysis Report: Backdoor.Win32.Generic.RetrievedSeptember22,	2011,	from	GFI	SandBox:http://xml.ssdsandbox.net/view/6c6adbd087276ae89f8262582798b708GFISandBox.(2011,July	15).	GFI SandBox Malware Analysis Report: Trojan.Win32.AgentBypass.	Retrieved	August25,	2011,from	http://xml.ssdsandbox.net/view/fdf2c5c2b1874efe7fd335092df2d3bcGFISandBox.(2011,May	29).GFI SandBox Malware Analysis Report: Trojan.Win32.Generic!SB Trojan.Trojan.Win32.Generic.	RetrievedSeptember2011,2011,	from	 http://xml.ssdsandbox.net/view/bce1069dd099f15170c5fd05bae921b5GFISoftware.(2011,February	08).	CWSandbox Report By	 MD5 	at Sunbelt Security.	RetrievedSeptember22,	2011, fromhttp://www.sunbeltsecurity.com/partnerresources/cwsandbox/md5.aspx?id=e8ee9373ee6c836042e8f48d8de2dda9Goodin,D.	(2011,	August12).	Software maker fingered in Korean hackocalypse. RetrievedSeptember06,2011, fromTheRegister:http://www.theregister.co.uk/2011/08/12/estsoft_korean_megahack/PAGE13OF24COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED. Hauri.ResponseTeam.(2011,	August	04).	SK Communications detailed analysis report of nateon.exe malware.	Retrieved	August12,	2011,	from	http://www.hauri.co.kr/updata/SK_detail_report.pdfHispasecSistemas.	(2011,	September06).	VirusTotal.	RetrievedSeptember22,	2011,	fromhttp: /www.virustotal.com/file.scan/report.html?id=727c5a2c3db079351a79351a79367a1d9eada072a8e19bce0a02eb680088e8eae9bd67.1315308204HispasecSistemas.	(2011,	August03).	VirusTotal .Free online	Virus, Malware and URL Scanner.RetrievedAugust12,	2011,from	http://www.virustotal.com/file.scan/report.html?id=74455d5e8f99272aec64bce106b1e8ff39a122a7d27d362a274af31ab5a4fb1e.1313643321HispasecSistemas.	(2011,	August19).	VirusTotal .Free Online	 Virus, Malware and URL Scanner.Retrieved	September22,	2011,	from	http://www.virustotal.com/file.scan/report.html?id=74455d5e8f99272aec64bce106b1e8ff39a122a7d27d362a274af31ab5a4fb1e.1313760695HispasecSistemas.	(2011,	July	29).	VirusTotal .Free	Online	Virus, Malware and URL Scanner.RetrievedSeptember22,	2011,from	http://www.virustotal.com/file.scan/report.html?id=74455d5e8f99272aec64bce106b1e8ff39a122a7d27d362a274af31ab5a4fb1e.1311902003HispasecSistemas.	(2011,	August07).	VirusTotal .Free Online	 Virus, Malware and URL Scanner.Retrieved	August	18,	2011,from	http://www.virustotal.com/file.scan/report.html?id=b6aecab3c07e915e27db4b4be4c32de1ffa613029818bbd1bb755653c10fbe38.1311920836JapaneseIT	PromotionAgency.	(2011,	June29).IPA/ISEC: Vulnerabilities: Security	 Alert for	Vulnerability	 in ALZip.Retrieved	September18,2011,	from	JapaneseIT	PromotionAgency:http://www.ipa.go.jp/security/english/vuln/201106_alzip_en.htmlJin.woo	Seo,	J..h.	H.	(2011,	July	28).	35mn User Info Leaked in Cyber Attack	 against S. Korean Portals. Retrieved	September19,	2011,	from	MK	BusinessNews:	http://news.mk.co.kr/english/newsRead.php?sc=30800005&cm=General&year=2011&no=491540&selFlag=sc&relatedcode=&wonNo=&sID=308JSUNPACK.(2011,July	27).jsunpack .a generic	JavaScript unpacker.	RetrievedAugust	14,	2011,	from	http://jsunpack.jeek.org/dec/go?report=9f5addc7e0c7c57eab347ba10e9a81a032cf0dafJSUNPACK.(2011,July	27).jsunpack .a generic	JavaScript unpacker.	RetrievedAugust	08,	2011,	from	http://jsunpack.jeek.org/dec/go?report=f84cd73dabf186607f986df98c5402a57bb58ad1JSUNPACK.(2011,July	27).jsunpack .a generic	JavaScript unpacker.	RetrievedAugust	04,	2011,	from	http://jsunpack.jeek.org/dec/go?report=2c645b8dee2789a0d5d1c1e173ca3bb6b0d0528eKryo.(2010,	February	6).	kryo.se: iodine	(IP.over.DNS, IPv4 over DNS tunnel).	RetrievedSeptember18,2011,from	kryo.se:	http://code.kryo.se/iodineMalc0de.com.	(n.d.).	116.127.121	 |	 Malc0de	Database. RetrievedAugust	22,2011,from	Malc0deDatabase:	http://malc0de.com/database/index.php?search=116.127.121&IP=onMicrosoft.	(2007,	December10).A description of Svchost.exe	 in Windows XP Professional	 Edition. Retrieved	September07,	2011,	from	Microsoft	Support:http://support.microsoft.com/?kbid=314056 PAGE14OF24COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED. Microsoft.	(2007,	December04).What is a DLL? Retrieved	September18,	2011,	fromMicrosoftSupport: http://support.microsoft.com/kb/815065 Microsoft.	(n.d.).	Security	 Center .Bulletins Advisories Tools	Guidance	Resources. Retrieved	September09,	2011,	fromMicrosoft	Security	TechCenter:http://technet.microsoft.com/en.us/security/defaultMisterGroup.	(n.d.).	nateon.exe	 .What is the	 nateon.exe? Retrieved	September06,	2011,	from	 http://systemexplorer.net/db/nateon.exe.html Moon.young,	L.	(2011,	August12).	Personal	 information hack	 traced to	 Chinese IP	 address. RetrievedSeptember 09,	2011,from	TheHankyorehMediaCompany:http://english.hani.co.kr/arti/english_edition/e_national/491514.html Mullaney,	C.	(2011,July	30).	Backdoor.Sogu Technical	 Details	| Symantec.	Retrieved	August18,	2011,	from	 http://www.symantec.com/security_response/writeup.jsp?docid=2011.073003.5345.99NationalInstituteofStandardsand	Technology.	(n.d.).	National	 Vulnerability	 Database.	RetrievedSeptember20, 2011,	fromhttp://nvd.nist.gov/home.cfmNovell.	(2011).	Novell Customer: Cite	Media Holding Group.	Retrieved	July	29,	2011,	from	 http://www.novell.com/success/cite.html Parkour,	M.(2011,July	14).contagio: Jul 13 CVE.2010.2883 PDF Meeting Agenda with more Poison Ivy www.adv138mail.com |	 112.121.171.94. RetrievedSeptember22,	2011,	fromContagiodumpBlog:	http://contagiodump.blogspot.com/2011/07/jul.13.cve.2010.2883.pdf.meeting.agenda.htmlSamsungIDC.(2011,August05).	Samsung IDC	Helpdesk Notice.	Retrieved	August12,2011,	from http://www.samsungidc.com/helpdesk/notice_view.jsp?bpd_seq=0000001532 SKCommunications.(n.d.).	SK	 Communications .About Us.	RetrievedSeptember06,2011,	from http://corp.skcomms.co.kr/eng/global.htmSung.jin,	Y.	(2011,July28).	35m	 Cyworld, Nate	users' information hacked. Retrieved	September06,	2011,	from	 KoreaHerald:	http://www.koreaherald.com/lifestyle/Detail.jsp?newsMLId=20110728000881 TheInternetArchive.	(2010,August14).	Error	page. Retrieved	September18,	2011,	from	TheInternetArchive WaybackMachine:http://web.archive.org/web/20100814135834/http://www.cph.com.tw/1jebugldgJtOAjb1wnXe8A== ThreatExpert.(2011,July	13).	ThreatExpert Report: Trojan.Win32.Scar.dysk, Bat/sdel.	RetrievedSeptember22,	2011,	fromhttp://www.threatexpert.com/report.aspx?md5=16a31aa8e7ddf66a31551840573b6575ThreatExpert.(2011,August03).	ThreatExpert Report: Trojan.Win32.Scar.dzoc.Retrieved	September22,2011,fromhttp://www.threatexpert.com/report.aspx?md5=bce1069dd099f15170c5fd05bae921b5ThreatExpert.(2011,July	29).	ThreatExpert Report: Virus.Win32.Virut.	RetrievedSeptember22,2011,from	 http://www.threatexpert.com/report.aspx?md5=aba9baea70825e6adf0723587f273dc4TMCnews.	(2011,	August11).	S. Korea plans to	 scrap online	real.name	system. RetrievedSeptember19,2011,from	 TMCnews:http://www.tmcnet.com/usubmit/2011/08/11/5698912.htm ANNEX A LIST	 OF	 DEOBFUSCATED STRINGS FOUND WITHIN ‘NATEON.EXE’ Stringsinside‘nateon.exe’arestoredinanobfuscatedformandonlydeobfuscatedas,	and	while,they	areneeded. This	tablecontainsacompletelistofdeobfuscatedstringsextractedduringstaticbinary	analysis	ofthemalicious file.	Foreach	string,	twoaddressesareprovided	 – the ‘CodeAddress’ and the‘Obfuscated	Address’. The ‘CodeAddress’is	theaddress,	incode,	from	which	thestring	deobfuscationisrequested.	This	addresscan beused	toefficiently	 identify wrapper functions that dynamically import system APIs (such as those used for networkcommunications),	aswellastolocateinteresting	partsofthemalware.	The‘Obfuscated	Address’is	theaddress,	indata,	wheretheobfuscated	string	is	stored.	 For readability,	 the strings presented	 in the ‘Deobfuscated	 String’ column have been converted from their originalformats.Someof	thestringsarestored	inside‘nateon.exe’as8.bitcharacterstringsandsomeas16.bitwidecharacterstrings.	Non.printablecharactershavebeenescapedashexadecimalvaluesintheform	‘<\xHH>’ or ‘<\uHHHH>’.	 Trailing	 null (‘<\x00>’) characters are not	 shown.	 Standard	 escape sequences such	 as ‘\n’ (newline)and‘\r’(carriagereturn)arealsoused	toimprovereadability. CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  10001022  100220C0  LocalFree  10001071  100220CC  GetOEMCP  100010BB  100220D8  GetCommandLineW  10001105  100220EC  GetCurrentProcess  1000114F  10022100  Sleep  1000119E  10022108  ExitProcess  100011EA  10022118  TerminateProcess  1000123B  1002212C  lstrcmpiW  1000128D  10022138  WaitForSingleObject  100012DF  10022160  SetEvent  1000132E  1002216C  GetLastError  10001378  100221B0  CommandLineToArgvW  100013F5  10022150  TlsSetValue"  10001761  100221C4  SeDebugPrivilege  100017A2  100221E8  SeTcbPrivilege  10001A97  1002217C  SetServiceStatus  10001B6A  10022208  "SMI"51  10001BD6  10022214  "SMU"  10001C47  10022220  "SMRAC"  10001C8A  10022230  "SMRACU"  10001DA0  10022190  RegisterServiceCtrlHandlerExW  10003AD9  10022240  GetProcessHeap  10003B23  1002225C  HeapFree  10003B8F  10022250  HeapAlloc  10003C64  10022268  FreeLibrary  10003CCD  10022278  "ntdll.dll52"  10003D03  10022284  "kernel32.dll"  51 SMI, SMU, SMRAC, SMRACU are the operating	 modes of‘nateon.exe’.(Hauri.ResponseTeam,2011)52 The strings	 with suffix ‘.dll’ identify modules loadeddynamicallybythemalware. CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  10003D46  10022294  "user32.dll"  10003D8A  100222A0  "advapi32.dll"  10003DC9  100222B0  "gdi32.dll"  10003E09  100222BC  "ws2_32.dll"  10003E4C  100222C8  "shell32.dll"  10003E90  100222D8  "shlwapi.dll"  10003ED2  100222E8  "psapi.dll"  10003F12  100222F4  "mpr.dll"  10003F52  10022300  "wtsapi32.dll"  10003F88  10022310  "version.dll"  10003FC8  10022320  "msvcrt.dll"  10004008  1002232C  "wininet.dll"  10004048  1002233C  "sfc.dll"  10004089  10022348  "odbc32.dll"  100040C8  10022354  "ole32.dll"  10004101  10022360  "iphlpapi.dll"  10004151  10022370  wsprintfA  10004192  1002237C  wsprintfW  100047B7  10022388  lstrlenA  10004806  10022394  lstrlenW  10004855  100223A0  MultiByteToWideChar  100048B2  100223B8  WideCharToMultiByte  10004913  100223D0  memcpy  10004969  100223D8  memset  10004FC9  100223E0  InitializeCriticalSection  10005035  100223FC  DeleteCriticalSection  100050C5  10022414  SetErrorMode  10005109  10022424  SeDebugPrivilege  10005137  10022448  SeTcpPrivilege  100054DE  1002285C  EnumServicesStatusW  CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  100056C8  100228A4  QueryServiceConfig2W  100084B0  10022774  10005854  10022C34  CompanyName  10008503  1002277C  1000589F  10022C50  10008544  10022764  System  100058DC  10022C58  FileDescription  1000856D  10022754  System  10005927  10022C00  10008596  10022728  SystemIdleProcess  1000596E  10022C7C  FileVersion  1000875B  100226F8  GetTcpTable  100059B9 100059F5  10022C98 10022CA0  ProductName  1000884E  10022680  AllocateAndGetTcpExTableFromStack"  10005A40  10022774  100088F8  100226C8  GetExtendedTcpTable"  10005A8C  10022CBC  ProductVersion  10008B17  100227D0  10005AD7  10022CDC  10008B5F  100227D8  10006021  10022468  CloseHandle  10008B99  100227C0  System  10006070 100060C8  1002249C 100224B4  GetDiskFreeSpaceExW GetVolumeInformationW  10008BC2 10008BEB  100227B0 10022784  System SystemIdleProcess  1000612A 1000617B 100061DB 1000622D 10006285  100224CC 100224E0 100224F0 10022500 10022510  CreateDirectoryW CreateFileW GetFileSize GetFileTime WriteFile"  10008DC4 10008E9C 10008F46 10008FDE 100093DD  10022708 100226A4 100226E0 100227E0 100227F8  GetUdpTable AllocateAndGetUdpExTableFromStack" GetExtendedUdpTable" WaitForMultipleObjects GetIconInfo  100062E0 1000633B 1000638A 100063E2 1000643A  1002251C 10022528 10022538 10022548 10022558  ReadFile" SetEndOfFile" SetFileTime SetFilePointer FindFirstFileW  1000942F 1000947E 100094D2 10009525 1000957A  10022808 10022818 10022828 10022838 10022848  DestroyIcon OpenProcess OpenSCManagerW OpenServiceW CloseServiceHandle  1000648C 100064DE 1000652D  10022568 10022578 10022584  FindNextFileW FindClose FlushFileBuffers"  100095C9 10009623 10009683  10022874 1002288C 100228BC  QueryServiceConfigW" ChangeServiceConfigW DeleteService  1000657C  10022598  lstrcpyW  100096D2  100228CC  StartServiceW  100065D0  100225A4  CreateProcessW  10009725  100228DC  ControlService  10006631  100225C8  memcmp  10009779  100228EC  CreateDCW  10006766  10022478  QueryDosDeviceW  100097CE  100228F8  GetDIBits"  100067B9 100067D3  100225D0 100225D0  ><\Device\Floppy<\x00><\uA4BC\u5CD1>" ><\Device\Floppy<\x00><\uA4BC\u5CD1>"  1000982C 1000987B 100098CA  10022904 10022910 10022920  DeleteDC DeleteObject ExtractIconExW  10006862  1002248C  GetDriveTypeW  10009923  10022930  EnumProcesses  10006941  100225F0  %s  10009978  10022940  EnumProcessModules"  10006990  100225F8  %s  100099D0  10022954  GetModuleFileNameExW  10006AC7  10022600  .  10009A28  10022984  SfcIsFileProtected"  100076E4  100225B4  SHFileOperationW  10009D14  10022A24  10007ACC  1002263C  WNetCloseEnum  10009D42  10022A2C  10007CD5  10022618  WNetOpenEnumW  10009D7E  100229F8  NTAUTHORITY  10007DE6  10022628  WNetEnumResourceW  10009DAD  10022A14  SYSTEM  10007F65  10022650  %s  10009DD6  100229CC  NTAUTHORITY  10007FB7  10022658  %s  10009E05  100229E8  SYSTEM  10007FFC  10022660  %s  10009E39  100229A0  NTAUTHORITY  1000804F  10022668  %s  10009E6B  100229BC  SYSTEM  100081E5  10022670  GetVersionExW  10009ECA  10022A80  1000825D  10022718  SetTcpEntry  10009F13  10022A70  System  CAODE	DDR OADDRBFUSCATED DEOBFUSCATEDSTRING ESS ESS CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  1000CC42  10022EA4  CloseWindowStation  1000CC91  10022EB8  OpenInputDesktop  1000CCE4  10022ECC  SetThreadDesktop  1000CD33  10022EE0  GetThreadDesktop  1000CD82  10022EF4  CloseDesktop  1000CDD1  10022F04  SetCursorPos"  1000CE23  10022F44  GetCurrentThreadId"  1000CE6D  10022F58  CreateThread  1000CEC8  10022F68  CreateCompatibleDC  1000CF17  10022F7C  CreateDIBSection  1000CF72  10022F90  SetDIBColorTable"  1000CFC9  10022FA4  GdiFlush"  1000D013  10022FB0  GetDeviceCaps"  1000D067  10022FC0  BitBlt  1000D0C9  10022FC8  SelectObject  1000D136  10022FD8  DISPLAY"  1000DB81  10022FEC  DISPLAY"  1000DE8A  10023000  DISPLAY"  1000E3BE  10023014  DISPLAY"  1000E9AB  10022F34  PostMessageA  1000EA13  10022F24  keybd_event  1000EA8B  10022F14  mouse_event  1000EB1C  10023028  WinSta0"  1000EB3F  10022E74  OpenWindowStationW  1000EC3C  1002303C  GetTickCount  1000EC86  1002304C  ConnectNamedPipe  1000ECD8  10023060  CreateNamedPipeW  1000ED3F  10023074  GetOverlappedResult"  1000ED96  1002308C  CreateEventW  1000F0CF  1002309C  \\.\pipe\a%d<\x00><\u3CC4>< \u3C18><\u9C08><\u3C8A>"  1000F2B1  100230B8  \\.\pipe\b%d<\x00><\u7080>< \u0C17><\u4C49><\uEC10>"  1000F38F  100230D4  CMD.EXE  1000FC7B  100230E8  "SQLAllocHandle"53  1000FCD0  100230F8  "SQLSetEnvAttr"  1000FD2A  10023108  "SQLDriverConnectW"  1000FD88  1002311C  "SQLDisconnect"  1000FDD7  1002312C  "SQLFreeHandle"  1000FE29  1002313C  "SQLExecDirectW"  1000FE7D  1002315C  "SQLNumResultCols"  1000FECF  1002319C  "SQLMoreResults"  10010339  10023170  "SQLColAttributeW"  100104B5  10023184  "SQLFetch"  1001052B  10023190  "SQLGetData"  1001057D  100231AC  NULL"  10010627  1002314C  "SQLGetDiagRecW"  System SystemIdleProcess CompanyName FileDescription FileVersion ProductName ProductVersion GetModuleInformation \??\<\x00><\uFC04><\uF06C>" \SystemRoot\<\x00><\u7C84><\u98E4>" \<\x00><\uFFFD>" CompanyName FileDescription FileVersion ProductName ProductVersion DISPLAY" SYSTEM\CurrentControlSet\Serv ices\<\x00><\u90A0>Ü." \Parameters<\x00><\u3858>" ServiceDll RegOpenKeyExW RegCreateKeyExW RegQueryValueExW RegSetValueExW RegEnumKeyExW RegCloseKey SHCopyKeyW SHDeleteKeyW SHDeleteValueW SHGetValueW SHEnumKeyExW SHEnumValueW VirtualAlloc VirtualFree GetProcessWindowStation SetProcessWindowStation PAGE18OF24COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED. 10009F42 10009F6E 10009F9A 10009FDB 1000A020 1000A064 1000A0A9 1000A0ED 1000A131 1000A175 1000A1AF 1000A1F3 1000A730 1000A7CC 1000A805 1000A859 1000A8AE 1000A919 1000A95B 1000A999 1000A9D8 1000AA13 1000AA52 1000AA8E 1000AAD0 1000AB0E 1000AB50 1000B445 1000B6A3 1000B6DB 1000B70E 1000B77F 1000B7DD 1000B83D 1000B899 1000B8F8 1000B953 1000B9A2 1000B9F9 1000BA4B 1000BAA0 1000BE37 1000C492 1000CAFB 1000CB53 1000CBA9 1000CBF3 10022A60 10022A34 10022A88 10022AA4 10022AAC 10022A24 10022AD0 10022AEC 10022AF4 10022998 10022B10 10022B30 1002296C 10022B38 10022B40 10022B4C 10022B68 10022B70 10022B8C 10022B94 10022BB8 10022BC0 10022BDC 10022BE4 10022C00 10022C08 10022C28 10022CE4 10022CF8 10022D40 10022D5C 10022D74 10022D84 10022D98 10022DAC 10022DBC 10022DCC 10022DDC 10022E08 10022E18 10022E28 10022DE8 10022DF8 10022E38 10022E48 10022E58 10022E88 53 Theimportedfunctionswithan‘SQL’prefixwere presumablyusedtoaccess	theSKCommunications	databases. CAODE	DDR OADDRBFUSCATED DEOBFUSCATEDSTRING ESS ESS CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  10012DF9  10023604  GetTokenInformation  10012E54  10023630  LookupPrivilegeValueW  10012EA8  10023648  AdjustTokenPrivileges"  10012F02  100236B4  GetFileVersionInfoW  10012F59  100236CC  VerQueryValueW  100130F1  1002353C  GetWindowsDirectoryW  10013158  10023554  GetSystemDirectoryW  100132AD  10023588  GetComputerNameW  1001337D  10023660  GetUserNameW  10013445  10023748  CLSID  10013465  10023758  "SOFTWARE\CLASSES\SAFEGUI  <\x00><\u40F0><\u380B>"54  100134D4  1002378C  CLSID  100134EA  10023758  "SOFTWARE\CLASSES\SAFEGUI  <\x00><\u40F0><\u380B>"  1001357C  1002352C  GetSystemTime  100136DC  100237A0  %2.2X%2.2X%2.2X%2.2X%2.2X%2.2X%2.2X%2.2X"  10013749  100237F4  %ALLUSERSPROFILE%  100137C6  10023820  \Documentsand	Settings\AllUsers<\x00><\uC030><\u0848> "  10013807  10023868  \Documentsand	Settings\AllUsers<\x00><\u78D8><\u6090> "  1001384C  100238B0  \Documentsand	Settings\AllUsers<\x00><\u3818><\u20D0> "  1001389A  100238F8  \ProgramData<\x00><\uE8A8>"  100138D8  10023914  \ProgramData<\x00><\uFFFD>"  10013907  10023930  \<\x00><\uB898>"  10013B54  10023938  \ . <\x00><\u140C>"  10013E1F  10023944  .EXE  10013EFB  10023950  .EXE  1001404B  1002395C  \??\<\x00><\u742C><\uCC38>  1001409E  10023968  \SystemRoot\<\x00><\u0808><\u5834>"  100140F1  10023984  \<\x00><\u18B8>"  10014219  1002361C  LookupAccountSidW  100143AE  10023670  WTSEnumerateProcessesW  10014461  10023688  WTSFreeMemory  100144FB  10023698  GetFileVersionInfoSizeW  1001459E  1002398C  <\VarFileInfo\Translation<\x00>\uEC54><\u2C48>"  10014605  100239C0  <\StringFileInfo\%4.4X%4.4X\%s\x00><\uF8D8><\uE090><\u2 379>"  10014992  10023A00  IsWow64Process  10010739 1001078A 10010808 100108CC 100109C8 10010ACC 10010D37 10010D95 10010DE7 10010E3B 10010EC2 10010F47 10010FC1 10011044 10011096 1001110F 1001134D 10011617 10011643 1001166F 100116A3 100116F3 10011738 100117A2 10011AE2 10011CAA 10011D3A 10011E6D 10011EAD 10011F88 10011FE7 1001203D 1001208C 100120DB 10012136 10012188 100121D7 100122CB 10012379 1001255F 10012687 10012779 10012C0D 10012C5C 10012CAB 10012D00 10012D55 10012DAA 100231DC  ExitWindowsEx  100231EC  InitiateSystemShutdownA  100231C8  LockWorkStation  10023208  SeShutdownPrivilege  10023234  SeShutdownPrivilege  10023260  SeShutdownPrivilege  100231B8  MessageBoxW  100232F0  GetConsoleMode  10023318  SetConsoleCtrlHandler  1002337C  SetConsoleScreenBufferSize  10023330  WriteConsoleInputW  100232CC  GetConsoleCP  100232DC  GetConsoleOutputCP"  10023300  GetConsoleDisplayMode"  100233AC  GetConsoleCursorInfo  10023360  GetConsoleScreenBufferInfo  10023398  ReadConsoleOutputW  100233D4  CMD  100233E0  100233E8  /Q  100232A8  AllocConsole  100232B8  GetConsoleWindow"  1002328C  ShowWindow"  10023298  GetStdHandle  100233C4  FreeConsole  100233F0  CONIN$"  10023344  GenerateConsoleCtrlEvent  10023400  CONIN$"  10023410  CONOUT$  10023424  CreateWindowExW  10023438  SetWindowLongW  10023448  DestroyWindow"  10023458  TranslateMessage  1002347C  SetTimer  10023488  KillTimer  100234A4  DispatchMessageW  100234F8  onWTSUnRegisterSessionNotificati"  10023494  PeekMessageW  1002351C  static  100234D8  WTSRegisterSessionNotification  100234B8  MsgWaitForMultipleObjectsEx  1002346C  DefWindowProcW  1002356C  QueryPerformanceCounter  1002359C  GetFileAttributesW  100235B0  ExpandEnvironmentStringsW  100235CC  GetModuleFileNameW  100235E0  OpenProcessToken  100235F4  GetLengthSid  54 The unusual hardcoded registry key ‘SOFTWARE\CLASSES\SAFEGUI’	can beusedto link‘nateon.exe’ withthemalwarethathas	theMD5	hash6C6ADBD087276AE89F82	 6258 2798 B708 and calls back to the domain‘expre.dyndns.tv’ on TCP port 443.	 It may also be used	 as	 a signaturetoidentifyothersimilarmalware.(GFISandBox,2011)SOFTWARE\Microsoft\WindowsSvcHost<\x0 C><\uFFFD> SOFTWARE\Microsoft\WindowsSvcHost<\x0 C><\uFFFD> SOFTWARE\Microsoft\WindowsSvcHost<\x0 C><\uFFFD> SOFTWARE\Microsoft\WindowsSvcHost<\x0 C><\uFFFD> GetWindowThreadProcessId SHCreateItemFromParsingName "\SYSPREP<\x00><\uF8D8>" "\SYSPREP.EXE<\x00><\u18B8 >" 100186F4 1002401C 10018720 10024030 CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING CAODE	DDROADDRBFUSCATEDDEOBFUSCATEDSTRING ESS ESS  100149F5  10023A10  GetCurrentProcessId 10016519 10023DA4 <\x00><\u74AC>"  10014A3F  10023A28  ProcessIdToSessionId" 1001654C 10023AF4 RqSkce  10014A91  10023A40  DuplicateTokenEx 10016582 10023DAC  10014AEE  10023A54  SetTokenInformation 100165BE 10022208 SMI  10014B46  10023A98  CreateProcessAsUserW 100165FD 10023DB4  100151CE  10023AB0  .DLL" 1001663B 10023DBC <\x00><\u14EC>"  10015202  10023ABC  RUNDLL32.EXE 10016691 10023DC4 <\x00><\u28E8>"  1001522E  10023ADC  <\x00><\u6010>" 1001689E 10023BE0 DeleteFileW  10015268  10023AE4  \<\x00><\u3080> 100169F3 10023C14 GetModuleFileNameA  100152A0  10023AEC  <\x00><\u6868>" 10016A4A 10023BD0 CreateFileA  100152CC  10023AF4  RqSkce 10016DAA 10023DEC QueryServiceStatusEx  100152F8  10023B04  10016E03 10023E04 ChangeServiceConfig2W  10015324  10022220  SMRAC 10016E59 10023E1C CreateServiceW  100153FC  10023B0C  "UserEnv.dll" 1001779C 10023E30 NT\CurrentVersion\ 1001542A  10023B1C  CreateEnvironmentBlock" 0><\uA8E8><\uC40 10015456  10023B34  DestroyEnvironmentBlock" <\u9050>"  100155C1  10023B50  .DLL" 1001791E 10023E9C  1001561B  10023B5C  RUNDLL32.EXE 10017956 10023E30 NT\CutVersi\ 10015656  10023B7C  rrenon<\x00><\u843C> 0><\uA8E8><\uC40 1001569E  10023B84  \<\x00><\u68A8> <\u9050>"  100156EF  10023B8C  <\x00><\uCCF4> 10017A37 10023E30 NT\CutVersi\ 10015722  10023AF4  rrenonRqSkce 0><\uA8E8><\uC40 1001575D  10023B04  <\u9050>"  10015790  10022230  SMRACU 10017BE1 10023EA0  100157E1  10023A6C  ImpersonateLoggedOnUser 10017C10 10023E30 NT\CutVersi\ 1001586B  10023A88  RevertToSelf rrenon0><\uA8E8><\uC40 10015943  10023B94  WTSGetActiveConsoleSessionId" <\u9050>"  10015C5E  10023BB4  NTAUTHORITY 10017C5F 10023EA4 VirtualAllocEx  10015D15  10023BF0  MoveFileExW 10017CBC 10023EB4 VirtualFreeEx  10015D68  10023C00  GetModuleHandleA 10017D15 10023EC4 WriteProcessMemory  100160D5  10023C28  "%SystemRoot%\system32\sv 10017D74 10023EEC  chost.exe .k  LocalService<\x00><\uBC64>< 10017DC6 10023F18 GetExitCodeThread  \uD4CC>"55 10017E18 10023F48 EqualSid"  10016108  10023C90  SYSTEM\CurrentControlSet\Serv 10017E6A 10023F54 FreeSid ices<\x00><\u54AC><\u8C34>" 10017EB9 10023F60 ShellExecuteExW  10016138  10023CD8  \<\x00><\uC4FC>" 10017F08 10023F74 "  10016183  10023CE0  \Parameters<\x00><\uA8A8>"  100161C2  10023CFC  LocalService 10017F61 10023FA4 CoCreateInstance  10016267  10023D18  ServiceDll 10018226 10023F2C AllocateAndInitializeSid"  100162B6  10023AF4  RqSkce 100184E2 10023FC8 .DLL"  100162C8  10023AF4  RqSkce 10018534 10023FD4 <\x00><\u7CA4>  100162E3  10023D30  ServiceMain 1001856E 10023FDC \<\x00><\u9C04>"  10016389  10023D4C  LocalService 100185A6 10023FE4 <\x00><\u1020>  100163EF  10023D68  .DLL" 100185D2 10023AF4 RqSkce  1001642B  10023D74  \<\x00><\u344C>" 100185FE 10023FEC  1001649E  10023D7C  RUNDLL32.EXE 1001862A 10022208 SMI  100164D0  10023D9C  <\x00><\u8070>"  55 The‘nateon.exe’dropperconfigures	‘winsvcfs.dll’toruninsidethetrusted	 ti t ‘svchost.exe’.opera ng	sys emprocess PAGE20OF24COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED. CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  1001881A  10024058  LoadLibraryW  10018836  10024068  "kernel32.dll"  10018879  10024078  FreeLibrary  10018890  10024068  "kernel32.dll"  10018B30  10022B68  \<\x00><\uFFFD>"  10018B71  10024088  sysprep  10018BE4  10023F94  CoInitializeEx  10018C88  1002409C  "CRYPTBASE.DLL"  10018D00  100240BC  \<\x00><\u5C44>"  10018D3A  100240C4  sysprep  10018D7D  100240D8  \<\x00><\u0888>  10018DBB  100240E0  "CRYPTBASE.DLL"  10018E1B  10024100  \<\x00><\u1020>  10018E46  100240C4  sysprep  10018E75  10024108  \<\x00><\u8070>  10018EA7  10024110  sysprep.exe  10018FB8  10023FB8  CoUninitialize  1001903E  1002412C  "CRYPTBASE.DLL"  100190B1  1002414C  .DLL"  10019112  10024158  RUNDLL32.EXE  1001914B  10024178  <\x00><\uF858>"  10019197  10024180  \<\x00><\u6010>  100191E0  10024188  <\x00><\uF42C>  10019219  10023AF4  RqSkce  10019252  10024190  1001928B  10022208  SMI  1001949A  10023ED8  CreateRemoteThread"  10019534  10024198  Shell_TrayWnd"  10019558  10023F08  FindWindowA  100195E4  100241C8  GetCurrentThread"  1001962E  100241DC  SetThreadPriority  100197F3  10024204  GetSystemMetrics"  10019842  10024230  gethostbyname  10019891  10024240  lstrcatW  100198E3  1002424C  ResumeThread"  10019939  1002425C  QueueUserAPC  1001A25C  100242C8  \\.R \PIPE\RUN_AS_CONSOLE_USE (%d)<\x00><\u0CB4><\u40E5 ><\u4033><\uC0C0>"  1001A419  1002426C  "download.windowsupdate.co  m"56  1001A66A  10024288  \\.\PIPE\RUN_AS_CONSOLE(%d )<\x00><\u7000><\u78D8><\u6090><\u2828>"  1001A914  100241F0  GlobalMemoryStatus  1001AA61  100236DC  MHZ"  1001AA7F  100236E8  HARDWARE\DESCRIPTION\SYSTEM\CENTRALPROCESSOR\0<\x  56 The hardcoded domain name ‘download.windowsupdate.com’ is	used	todetectinternetconnectivity.Thisdomainnamecanbeoverriddeninthemalware’sconfiguration. CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  00><\u70C0><\u28FB><\u38E4><\u680B>"  1001AB05  10024218  GetSystemDefaultLCID  1001AB81  1002430C  %s  1001ABC1  10022658  %s  1001AC02  10024314  1001AC23  10024318  %s  1001AC6B  10024320  %s  1001ACA4  10022658  %s  1001ACE1  10024328  1001ACFC  1002432C  %s  1001B0D7  10024334  .DLL"  1001B11A  10024340  RUNDLL32.EXE  1001B15A  10024360  <\x00><\u5878>  1001B1B4  10023FDC  \<\x00><\u9C04>"  1001B1F4  10024368  <\x00><\u9CE4>  1001B22C  10023AF4  RqSkce  1001B266  10024370  1001B29B  10022214  SMU  1001B54A  10024378  RtlNtStatusToDosError  1001B599  100243B0  RtlDecompressBuffer  1001B5F8  100243C8  RtlCompressBuffer  1001B677  10024390  zeRtlGetCompressionWorkSpaceSi"  1001BD1B  10024288  \\.\PIPE\RUN_AS_CONSOLE(%d )<\x00><\u7000><\u78D8><\u6090><\u2828>"  1001BEDB  100243DC  TerminateThread  1001BF2F  10024418  SetUnhandledExceptionFilter  1001BF7E  100243F0  TlsAlloc  1001C028  1002440C  TlsFree  1001C0CB  100243FC  TlsGetValue  1001C139  10024438  ECount %d,"  1001C180  10024450  EAddr 0x%p,  1001C1CC  1002446C  ECode=0x%x,  1001C214  10024488  ESalF=%d"  1001C2D4  1002449C  MessageBoxA  1001C32C  100244AC  lstrcpyA  1001C380  100244B8  InternetOpenA  1001C3D4  100244C8  InternetOpenUrlA"  1001C431  100244DC  InternetReadFile  1001C489  100244F0  InternetCloseHandle  1001C510  10024508  "XXXXXXXX"57  1001C5E3  10024514  "DEMO"  1001C618  10024520  "TVT"  1001C658  10024528  "TVT	 DEMO"  1001C6DA  10024534  "192.168.0.200"  57 This	setofhardcoded	strings,‘XXXXXXXX’,‘DEMO’,‘TVT’,‘TVTDEMO’,and‘192.168.0.200’arehardcodedvalues	overridden bythemalware’s	configuration. CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  CAODE	DDRESS  OADDRBFUSCATEDESS  DEOBFUSCATEDSTRING  1001C717  10024534  "192.168.0.200"  1001EFDD  100246FC  HttpOpenRequestA  1001C74F  10024548  1001F113  10024560  %2.2X  1001C7BF 1001CC41  1002454C 10024560  "CONFIG.DESTORY!"58 %2.2X  1001F189  10024570  Software\SafeSvc<\x00><\uB4EC>"  1001CCB2  10024570  "Software\SafeSvc<\x00><\uB  1001F278  100247D4  :  4EC>"59  1001F308  100247D8  "Proxy.Authorization: Basic  1001CD54  10024594  %2.2X  %s<\r><\n><\x00>öL"  1001CD98  100245A4  Software\SafeSvc<\x00><\u40F0>"  1001F39B 1001F3BC  100247FC 10024808  "X.Session"62 %s:%d  1001CDE7  100245C8  socket  1001F41E  10024810  "X.Status"  1001CE41  100245D0  bind"  1001F43F  1002481C  %s:%d  1001CE94  100245E0  setsockopt  1001F49B  10024824  "X.Size"  1001CEEE  100245EC  shutdown  1001F4B9  1002482C  %s:%d  1001CF3F  100245F8  closesocket  1001F507  10024834  "X.Sn"  1001CF95  10024608  ioctlsocket  1001F525  1002483C  %s:%d  1001CFEC  10024620  htons"  1001F776  10024844  1001D03B  10024634  WSAGetLastError  1001F7BB  10024848  1001D085  10024648  lstrcpynA  1001F7FC  100247FC  "X.Session"  1001D45C  100245D8  recv  1001F845  10024810  "X.Status"  1001D5C1  10024654  1001F889  10024824  "X.Size"  1001D67C  10024658  "Proxy.Authorization: Basic "  1001F8CD  10024834  "X.Sn"  1001D6B5  10024678  "GET "  1001FC5C  1002484C  %s  1001D6E8  10024680  "POST	 "  1001FC90  10024738  HttpQueryInfoA  1001D71B  10024688  "CONNECT "  10020324  10024850  connect  1001D775  10024658  "Proxy.Authorization: Basic "  10020378  1002486C  getpeername  1001D886  10024694  100203CF  10024894  WSAIoctl"  1001DA8F  10024618  ntohs  10020430  100248A0  WSAGetOverlappedResult"  1001DB03  10024628  inet_ntoa  10020662  100248B8  WSAStartup  1001E16D  100246C8  ResetEvent  100206C5  100248C4  WSACleanup  1001E1BE  100246D4  InternetConnectA  10020A04  100248D0  "CONNECT %s:%d	  1001E21A  100246E8  InternetWriteFile"  HTTP/1.1<\r><\n><\x00>d$"  1001E272  10024710  HttpSendRequestExA  10020A46  100248EC  "Content.length: 0<\r><\n><\x00>tl"  1001E2CA 1001E31F  10024724 10024748  HttpEndRequestA InternetSetOptionA  10020A7A  10024904  "Content.Type: text/html<\r><\n><\x00>|d"  1001E376  1002475C  HttpAddRequestHeadersA  10020AAE  10024920  "Proxy.Connection: Keep. 1001E3CF  10024698  EnterCriticalSection  Alive<\r><\n><\x00><\u2584 ><\u20A7>"  1001E420  100246B0  LeaveCriticalSection  10020B10  10024940  :  1001EE91  10024774  "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT	 5.1;SV1;"60  10020B63  10024944  "Proxy.Authorization: Basic %s<\r><\n><\x00><\u255D>"  1001EF9B 1001EFB6  100247B0 100247CC ‘ "/update?product=windows"61 "POST" ’	  10020C3E 10020C79  10024968 10024978  "HTTP/1.0 200 " "HTTP/1.1 200 "  58 The stri CONFIG.DESTOR’	 Y!id	s displayein a message box s	corrupgura 1002124B  1002485C  getsockname  ng	 when‘nateon.das	asigna exedetectttidtif tioninits	confition.Itcanbeiilarmalwa 100212C1  1002487C  WSASend  use59 Theunusua ureoenlhardcoded ysmre.tregisry key ‘Software\SafeSvc’	 canbeys 1002134E  10024888  WSARecv  usedas	asigna60 This	 itheuser turetoidentif.t inclu imilarmalware.dd	 inHTTP	dbth 10021438  10024998  static  s	li fid	  ee ed	 d l if 100214B6  10024988  GetMessageW  agen requests	ma ymawaretots	con gure comman an contro nrastructure.This	 malformed	 user.agent string can be used	 as	 a signature todetectmaliciousnetwork	traffic.61ThisisthepathincludedinHTTP	requestsmadeby‘nateon.exe’ toits	configured	command	andcontrolinfrastructure.Thisstring canbeusedas	asignaturetodetectmalicious	network	activity. 62 TheHTTPheaders‘X.Session’,‘X.Status’,‘X.Size’,and	‘X.Sn’	can beused	todevelopstrongersignatures for detectionofnetworkactivitygenerated	bythemalware. ANNEX B SUMMARY OF	 MALWARE KNOWN TO CREATE THE UNIQUELY NAMED DIRECTORY: ‘03A075FB70D5D675F9DC26FC’ MD5HASH  FILE	SIZE	(BYTES)  DATE(S)ANALYSED  FILESCREATED  NETWORK	CONNECTIVITY  16A31AA8E7DD	F66A31551840573B	6575  155648  13July2011(ThreatExpert,2011)  $$$$$$$$mtx.winscard2.exebat  TCP	port1058openedforinbound	connections  ABA9BAEA70825E6ADF0723587F273DC4  3514598  29July2011(ThreatExpert,2011)  zhenxiang.exewinscard.exe  TCP	ports1052and	1053	openedforinbound	connections  BCE1069D	D099F151 70C5FD05BAE921B5  133632  29May2011(GFISandBox,03August20 2011) 11(ThreatExpert,2011)  106140_d.battcmoniter.exe  pc.nprotects.orgonTCPport80  E8EE9373EE6C8360 42E8F48D8DE2DDA9  unknown  08February2011(GFISoftware,2011)  $$$$$$$$fbl.battcomoniter.exe  pc.nprotects.orgonTCPport80  FDF2C5C2B1874EFE 7FD335092DF2D3BC  unknown  15July2011(GFISandBox,2011)  40984_d.batwincard0.dlluxtheme.dll  bbs.ezxsoft.comonTCP	port80  COPYRIGHT	 NOTICE Copyright©CommandFivePty	Ltd.	Allrightsreserved. This	document	is	providedby	thecopyrightholdersunderthe licence thatfollows.	Byobtaining,using,	and/ordistributingthisdocumentyouagree that	 you have read, understood,	 and	 agree to the terms andconditionsthatfollow.Thenamesandtrademarksof CommandFivePty Ltdmay	not beusedinadvertisingorpublicity	relatingtothisdocumentorits	contents withoutspecific,	prior,	writtenpermission.Nopermissionisgivenforthisdocumenttobeused	forcommercialpurposes or as part of any	 commercial activity	 or undertaking, including,	 but	 not limited to,	 use in or relating	 to advertising or publicity,	and/oruseinsupportof,oraspartof,any	pre.salesorsales activities.Nopermissionisgiventocreatemodifiedorderivativeworks.	Youmay	 distribute this	 document	 in its original form for non.commercialpurposes in accordance with	 the other terms and	 conditions stated	herein.	 Copyright title will at all times remain with the copyrightholders.Allreferencedtrademarksremaintheproperty	of	theirrespective owners.THIS DOCUMENT	 IS PROVIDED	 ‘AS	 IS’ FOR INFORMATIONALPURPOSES ONLY WITH NO REPRESENTATIONS OR WARRANTIES	 OFANY KIND, INCLUDING BUT NOT LIMITED TO ANY WARRANTY,EXPRESS OR IMPLIED, OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE; WARRANTY OF	 NON.INFRINGEMENT, ORTITLE; NOR ANY WARRANTIES	 PERTAINING TO	 THE ACCURACY ORCOMPLETENESSOF	CONTENT. ANY OPINIONS	 EXPRESSED IN THIS DOCUMENT MAY CHANGEWITHOUT NOTICE AND	 ARE NOT NECESSARILY THE CONSIDEREDOPINIONS	OF	COMMAND	 FIVEPTYLTD,ITSPARTNERS,	 EMPLOYEES,OR AFFILIATE	 ORGANISATIONS.	 ANY ADVICE OFFERED IN THIS DOCUMENTISOFFERED	WITHOUTWARRANTYOFANYKIND. CommandFivePty	LtdABN:	49149	576	670http://www.commandfive.cominfo@commandfive.com 