Trend Micro About TrendLabs Security Intelligence Blog Home . Malware .  Latest Spam Campaigns from TA505 Now Using New Malware Tools Gelup and FlowerPippi Latest Spam Campaigns from TA505 Now UsingNew Malware Tools Gelup and FlowerPippi Posted on:July 4, 2019 at 5:30 am Posted in:Malware, SpamAuthor: Trend Micro By: Hara Hiroaki and Loseway Lu (Threats Analysts) Since our last research on TA505, we have observed new activity from the group that involves campaignstargeting different countries over the last few weeks. We found them targeting countries in the Middle Eastsuch as United Arab Emirates and Saudi Arabia, as well as other countries such as India, Japan, Argentina,the Philippines, and South Korea. This blog post covers the updates from TA505¡¯s campaigns and indicators of compromise (IoCs), as well asthe latest tactics, techniques, and procedures of these campaigns, particularly those observed in late June. Wealso analyzed a new malware tool named Gelup (detected by Trend Micro as Trojan.Win32.GELUP.A),which we saw the group use in one of the campaigns on June 20. Gelup abuses user account control (UAC) bypass and works as a loader for other threats. The tool also usesthe packer of FlawedAmmyy, a remote access trojan, from previous campaigns. TA505 is also usingFlowerPippi (Backdoor.Win32.FLOWERPIPPI.A), a new backdoor that we found them using in theircampaigns against targets in Japan, India, and Argentina. Our in-depth analysis of the Gelup malware andFlowerPippi backdoor, including their infection chains and C&C communication, is detailed in our technical brief. Targeting the UAETA505 targeted Middle Eastern countries in a June 11 campaign that delivered more than 90% of the totalspam emails to the UAE, Saudi Arabia, and Morroco. The spam emails contained either an .html or .xls .leattachment. The HTML .le leads to a download of another Excel .le embedded with malicious Excel 4.0 macro, which then downloads a FlawedAmmyy downloader (in .msi .le) that leads to the FlawedAmmyypayload. The direct .xls attachments were equipped with VBA macro. It fetches the same FlawedAmmyydownloader .msi .le, then downloads the FlawedAmmyy payload. Figure 2 shows the campaign¡¯s infectionchain. We saw similar campaigns on June 13, but these campaigns also delivered their malware via .doc .les, alongwith HTML and Excel .les. Figure 1. A sample spam email delivered to TA505¡¯s targets in the Middle East Figure 2. Infection chain of the spam emails with the FlawedAmmyy RAT Figure 3. Sample spam email sent on June 13 (top), and screenshot of code showing how the HTML .ledownloading a malicious document (bottom) On June 14, we saw TA505¡¯s campaign still targeting UAE with similar tactics and techniques, but this time,some of the spam emails were delivered via the Amadey botnet. They used Wizard (.wiz) .les in thiscampaign, with FlawedAmmyy RAT as the .nal payload. Figure 4. Sample spam email from a campaign observed on June 14 On June 18, the majority of the campaign¡¯s spam emails were sent with the subject, ¡°Your RAKBANK TaxInvoice / Tax Credit Note¡± or ¡°Con.rmation.¡± This campaign used the abovementioned .html .le, maliciousExcel/Word document VBA macro, the FlawedAmmyy payload, and Amadey. It later delivered aninformation stealer named ¡°EmailStealer,¡± which stolesimple mail transfer protocol (SMTP) credentials andemail addresses in the victim¡¯s machine. We found at least hundreds of  SMTP credentials on their C&C server. It also collected more than a million email addresses, 80% of which were either .com or .ae top-leveldomains (TLDs). Figure 5. A sample spam email from the campaign observed on June 18 (top); snippet of code showing themalware-embedded .doc .le that will be downloaded (center); and snapshot of email credentials being stolen(bottom) On June 24, we found another campaign targeting Lebanon with the ServHelper malware. This one had sub-campaigns that targeted India and Italy with different email content. Figure 6. Screenshot of spam email from a sub-campaign observed on June 24 targeting Italy Targeting banks in India and other countries in AsiaOn June 17, we observed the campaign¡¯s spam emails delivering malware-embedded Excel .les directly asan attachment. The spam emails used subject lines such as ¡°Emirates NBD E-Statement¡± and ¡°VisaCanceled¡± as social engineering lures. This campaign used the ServHelper loader, which was downloaded bythe VBA macro. A closer inspection of the email showed that its content would have been more applicable to Arabic-speakingusers or countries, particularly the UAE. In the spam emails that used ¡°Visa Canceled¡± on the subject line, forexample, the email claims to be from the General Directorate of Residency and Foreigners Affairs . Dubai,and contained Arabic content. Nonetheless, these spam emails were not delivered to the UAE or Arabic-speaking users, but to banks in Asian countries such as India, Indonesia, and the Philippines. June 17 (top); the ServHelper-related command-and-control (C&C) traf.c (center); and sample spam emailfrom a similar campaign that used a mix of .html and .xls .les to deliver the ServHelper loaderFigure 7. Sample spam email from a campaign observed on Targeting Japan, Philippines, South Korea, and ArgentinaOn June 20, we spotted the campaign¡¯s spam emails delivering .doc and .xls .les. We found the maliciousVBA macro downloading an apparently new and undocumented malware named FlowerPippi, as well asGelup (the details of the malware will be discussed below). On the same day, the campaign targeting South Korea also used .doc and .xls attachments. We did not .ndany attachments in the few samples we came across, but we found malicious URLs directly in the emailcontent instead. These URLs lead to the download of malicious .xls .les or .doc .les, with the .nal payloadstill being the FlawedAmmyy RAT. This gave us the opportunity to observe TA505¡¯s method of using URLsto deliver the entry point malware. Figure 8. Screenshot of a spam email targeting Japan, the Philippines, and Argentina (top), and another thattargets South Korea, which directly uses or embeds a malicious URL instead of an attachment (bottom) Gelup Downloader Malware and FlowerPippi BackdoorIn the campaign that targeted Japan, Philippines, and Argentina on June 20, we found what seems to be anew, undisclosed malware, which we named Gelup. After our analysis, we found that Proofpoint reported thismalware as AndroMut as well. A custom packer was used to pack some variants of this malware ¡ª the sameone that TA505 had been using. The unpacked payload is written in C++ and basically works as a downloader for another malware. Whatmakes Gelup different, however, is its obfuscation technique and UAC-bypassing function by mockingtrusted directories (spoo.ng the .le¡¯s execution path in a trusted directory), abusing auto-elevatedexecutables, and using the dynamic-link library (DLL) side-loading technique. As explained in our technical brief, Gelup supports techniques that can deter static and dynamic analyses, and has multilayered steps forinstalling itself into the system. Another new malware we found that TA505 is using in their campaigns last June 20 against targets in Japan,the Philippines, and Argentina is FlowerPippi. This malware acts as a backdoor and downloader, and is astandalone malware tool and retrieved more straightforwardly than Gelup. Our technical brief provides moredetails on FlowerPippi¡¯s capabilities and routines. Best practices and mitigationAs our research shows, the scale and extent of TA505¡¯s campaigns, which deliver a multitude of threats ¡ªfrom ransomware to information stealers and backdoors ¡ª make them signi.cant security issues toorganizations. Their active operations and ever-changing tactics are worth noting. In fact, we¡¯ve already seenthis in a recently disclosed research on their activities on the UAE, South Korea, Singapore, and the U.S. But more importantly, TA505¡¯s spam campaigns highlight the importance for organizations to secure theironline infrastructures, particularly the email gateways. Adopt best practices on thwarting messaging-relatedthreats; enforce the principle of least privilege to mitigate further exposure; and regularly update systems (or use virtual patching for legacy systems) to prevent attackers from taking advantage of security gaps.Additional security mechanisms like enabling .rewalls and intrusion detection and prevention systems will help thwart suspicious network activities that may indicate red .ags like data ex.ltration or C&Ccommunication. Organizations can also consider Trend Microþ endpoint solutions such as Trend Micro Smart Protection Suites and Worry-Freeþ Business Security. Both solutions can protect users and businesses from threats bydetecting malicious .les and spammed messages as well as blocking all related malicious URLs. Trend Micro Deep Discoveryþ has an email inspection layer that can protect enterprises by detecting maliciousattachments and URLs. Trend Microþ Hosted Email Security is a no-maintenance cloud solution that delivers continuously updatedprotection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before theyreach the network. It protects Microsoft Exchange, Microsoft Of.ce 365, Google Apps, and other hosted andon-premises email solutions. Our in-depth analysis of the Gelup malware is in this technical brief, while the IoCs related to the TA505¡¯s campaigns we observed are in this appendix. With additional insights and analysis by Kawabata Kohei 