New Fileless Botnet Novter Distributed byKovCoreG Malvertising Campaign Posted on:October 1, 2019 at 5:00 am Posted in:Bad Sites, Botnets, Malware Author: Trend Micro By Jaromir Horejsi and Joseph C. Chen (Threat Researchers) We found a new modular .leless botnet malware, which we named ¡°Novter,¡± (also reported and known as¡°Nodersok¡± and ¡°Divergent¡±) that the KovCoreG campaign has been distributing since March. We¡¯ve beenactively monitoring this threat since its emergence and early development, and saw it being frequentlyupdated. KovCoreG, active since 2011, is a long-running campaign known for using the Kovter botnet malware, which was distributed mainly through malvertisements and exploit kits. Kovter has been involved in click fraud operations since 2015, using fraudulent ads that have reportedly cost businesses more thanUS$29 million. The botnet was taken down at the end of 2018 through concerted efforts by law enforcementand cybersecurity experts, including Trend Micro. The dismantlement hasn¡¯t deterred the cybercriminals. Though the botnet is dead, we noticed that theKovCoreG campaign didn¡¯t stop their activities and instead developed another botnet. Working withProofPoint¡¯s threat researcher Kafeine, we were able to uncover a new .leless botnet malware ¡ª Novter ¡ªbeing distributed by the operators of KovCoreG. While the malvertising attacks were originally focused on U.S.-based users, they have since expanded toseveral European countries starting this summer. Our telemetry also revealed that the malvertising attackswere being distributed through a few of top 100 websites in the U.S., which were also abused by Kovter intheir previous activities. Our analysis of Novter, particularly its most notable modules, are detailed in thistechnical brief. Figure 1. Infection chain of KovCoreG, Novter, and Nodster KovCoreG¡¯s attack chain KovCoreG¡¯s attacks are socially engineered malvertisments that lure unwitting users into downloading asoftware package needed to update their supposedly out-of-date Adobe Flash application. However, it insteaddrops a malicious HTML application (HTA) .le named Player{timestamp}.hta. When the victim executes the HTA .le, it will load additional scripts from a remote server (communication is RC4-encrypted) and run aPowerShell script that appears to take inspiration from the open-source Invoke-PSInject project. Figure 2. Screenshot showing an example of KovCoreG¡¯s malvertisements (captured by ProofPoint) Figure 3. Snapshot of KovCoreG¡¯s malvertisement traf.c (captured by ProofPoint)The PowerShell script, in turn, will disable Windows Defender and Windows Update processes. It runs ashellcode to bypass User Account Control (UAC) via the CMSTPLUA COM interface (related to connectionmanagement). The PowerShell script is also embedded with Novter, which will be executed .lelessly via the PowerShell re.ective injection technique. Analysis of the Novter malware Novter is a backdoor in the form of an executable .le. Immediately after its execution, it performs thefollowing anti-debugging and anti-analysis checks: Searching for blacklisted processes and modules by comparing the CRC32 algorithms of their nameswith a list of hardcoded CRC32s Checking if the number of cores is too smallChecking if the process is being debuggedChecking if the Sleep function is being manipulated If it .nds any of aforementioned information, it is then reported to the C&C server. Note that it uses differentsets of C&C servers for different purposes. One set, for instance, is solely used for anti-analysis reporting.After the affected machine¡¯s environment is double-checked and reported, the malware goes to sleep for along time. The backdoor commands that Novter supports are: killall ¡ª Terminate a process and delete a .le (for all modules)kill ¡ª Terminate a process and delete a .le (for a speci.c module)stop ¡ª Terminate the process without deleting its .le (for a speci.c module)resume ¡ª Start a process (for a speci.c module)modules ¡ª Download and execute an additional module update ¡ª Download a new version and install the updateupdate_interval ¡ª Set an interval between two consecutive update attempts Novter communicates with its command-and-control (C&C) servers and downloads multiple JavaScriptmodules for different purposes. We have identi.ed three Novter modules, which include: A module that shows a technical support scam page on the victim¡¯s machineA module that abuses WinDivert (Windows packet divert, a tool that enables network packets sent toand from Windows network stacks to be captured, modi.ed, or dropped) to block the communicationfrom processes like those from antivirus (AV) softwareA module (which we named ¡°Nodster¡±) that is written with NodeJS and io for proxying networktraf.c. We consider it a module responsible for building the proxy network needed to support the clickfraud operations. Analysis of Novter¡¯s module ¡°Nodster¡± During our analysis of Novter, we came across three notable modules downloaded by the malware. One ofthem, which we named ¡°Nodster,¡± is a network proxy module. The module installs NodeJS on the victim¡¯smachine and executes a NodeJS script ¡°app.js¡± in the background. The script will connect to an embeddedC&C server address and receive the second C&C server address. It will then establish a backconnection to the second C&C server with the socket.io protocol. The secondC&C server will return commands to instruct the module to make a TCP connection, send a TCP payload,and return the response from the server back to them. This turns the system infected with Novter become aproxy for the attacker to use. Figure 4. The communication .ow between the Nodster proxy and C&C servers Correlating Nodster¡¯s traf.c During the course of our research, we observed lots of encrypted traf.c proxied through the Nodster module,but we managed to decrypt some of it, which showed scripts used for web advertising. This indicates that theC&C server instructed the infected machine to open a website with an embedded JavaScript code related todisplaying advertisements. We also noticed that the ad traf.c appeared to have been sent from Android devices, since the HTTP(S)requests transferred through the proxy had HTTP User-Agent headers from Android devices. These requestsare appended with a ¡°X-Requested-With¡± header with many Android app names. We inspected those apps onthe Google Play store because we initially thought that the traf.c could have been generated by theseapplications. However, we did not .nd any suspicious code in these applications that would have generatedthis traf.c. We didn¡¯t .nd any similar code shared between these Android applications either. Figure 5. The HTTPS request header spoofed to be from an Android deviceWith this .nding, we inferred that the ad traf.c was not coming from the mobile devices, but was insteadbeing generated by the attacker. The attacker disguised the traf.c to appear as if it was being sent fromAndroid devices and mobile applications and proxied them through the Novter/Nodster botnet. After all,KovCoreG¡¯s operations involved click fraud. Defending against Novter Advertisements are an innocuous online staple, but KovCoreG¡¯s campaign demonstrates how they can beintrusive, not to mention how Novter can expose the user¡¯s system to other and actual threats. Given howKovCoreG engages in click fraud, it can signi.cantly affect businesses. A single mobile ad fraud incident in 2018, for instance, cost Google and its partners around US$10 million in losses. Novter also exempli.es fraudsters¡¯ maturing techniques with its use of .leless infection methods andobfuscating its C&C connections and fraud-related traf.c. Users, for their part, should adopt best practices,especially against socially engineered threats like malvertisements. Trend Micro endpoint solutions, such as the Smart Protection Suites and Worry-Free Business Security that have behavior monitoring capabilities, can protect users and businesses from threats like Emotet by detectingmalicious .les, scripts, and messages as well as blocking all related malicious URLs. Trend Micro Apex Oneþ protection employs a variety of threat detection capabilities such as behavioral analysis, which protectagainst malicious scripts, injection, ransomware, memory and browser attacks. The full details of our research on Novter is in this technical brief, while the indicators of compromise (IoCs)are in this appendix. With additional analysis from Ecular Xu. Hat tip to ProofPoint¡¯s researcher Kafeine whom we worked with in this research. 