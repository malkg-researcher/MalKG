OPERATION COBALT KITTY: A LARGE­SCALE APT IN ASIA CARRIED OUT BY THE OCEANLOTUS GROUP 

WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!DubbedOperationCobaltKitty,theAPTtargetedaglobalcorporationbasedinAsia withthegoalofstealingproprietarybusinessinformation.Thethreatactortargeted thecompany’stop-levelmanagementbyusingspear-phishingattacksastheinitial penetrationvector,ultimatelycompromisingthecomputersofvicepresidents, seniordirectorsandotherkeypersonnelintheoperationaldepartments.During OperationCobaltKitty,theattackerscompromisedmorethan40PCsandservers, includingthedomaincontroller,leservers,Webapplicationserveranddatabase server. 
Forensicartifactsrevealedthattheattackerspersistedonthenetworkforatleast ayearbeforeCybereasonwasdeployed.Theadversaryprovedveryadaptiveand respondedtocompany’ssecuritymeasuresbyperiodicallychangingtools, techniquesandprocedures(TTPs),allowingthemtopersistonthenetworkforsuch anextensiveperiodoftime.Over80payloadsandnumerousdomainswere observedinthisoperation-allofwhichwereundetectedbytraditionalsecurity productsdeployedinthecompany’senvironmentatthetimeoftheattack. 
Theattackersarsenalconsistedofmodiedpublicly-availabletoolsaswellassix undocumentedcustom-builttools,whichCybereasonconsidersthethreatactor’s signaturetools.AmongthesetoolsaretwobackdoorsthatexploitedDLL sideloadingattackinMicrosoft,GoogleandKasperskyapplications.Inaddition,they developedanovelandstealthybackdoorthattargetsMicrosoftOutlookfor command-and-controlchannelanddataexltration. 
Basedonthetools,modusoperandiandIOCs(indicatorsofcompromise)observed 
TOPICS 
advanced 
persistent 
threat 


SHARE 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!,p( p) inOperationCobaltKitty, Cybereasonattributesthislarge-scalecyberespionage APTtothe“OceanLotusGroup”(whichisalsoknownas,APT-C-00,SeaLotusand APT32).FordetailedinformationtyingOperationCobaltKittytotheOceanLotus Group,pleaseseeourAttacker’sArsenalandThreatActorProlesections. 
CybereasonalsoattributestherecentlyreportedBackdoor.Win32.Denistothe OceanLotusGroup,whichatthetimeofthisreport’swriting,hadnotbeenofcially linkedtothisthreatactor. 
Finally,thisreportoffersarareglimpseintowhatacyberespionageAPTlookslike "under-the-hood".Cybereasonwasabletomonitoranddetecttheentireattack lifecycle,frominltrationtoexltrationandallthestepsinbetween. 
Ourreportcontainsthefollowingdetailedsections(PDF): 
. CobaltKittyLifecycle:Astep-by-stepanalysis 

. CobaltKittyAttacker’sArsenal:DeepdiveintothetoolsusedintheAPT 

. CobaltKittyThreatActorProleandIndicatorsofCompromise 

HIGH-LEVEL ATTACK OUTLINE: A CAT-AND­MOUSE GAME IN FOUR ACTS 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!Thefollowingsectionsoutlinethefourphasesoftheattackasobservedby Cybereason’sanalysts,whowerecalledtoinvestigatetheenvironmentafterthe company’sITdepartmentsuspectedthattheirnetworkwasbreachedbutcouldnot tracethesource. 

PHASE ONE: FILELESS OPERATION (POWERSHELL AND COBALT STRIKE PAYLOADS) 
Basedontheforensicevidencecollectedfromtheenvironment,phaseonewasthe continuationoftheoriginalattackthatbeganaboutayearbeforeCybereasonwas deployedintheenvironment.Duringthatphase,thethreatactoroperatedaleless 
PowerShell-basedinfrastructure,usingcustomizedPowerShellpayloadstaken fromknownoffensiveframeworkssuchasCobaltStrike,PowerSploitandNishang. 
Theinitialpenetrationvectorwascarriedoutbysocialengineering.Carefully selectedgroupofemployeesreceivedspear-phishingemails,containingeitherlinks tomalicioussitesorweaponizedWorddocuments.Thesedocumentscontained maliciousmacrosthatcreatedpersistenceonthecompromisedmachineusingtwo scheduledtasks,whosepurposewastodownloadsecondarypayloads(mainly CobaltStrikeBeacon): 
Scheduled task 1: DownloadsaCOMscriptletthatredirectstoCobaltStrike payload: 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!
Scheduled task 2: UsesJavascripttodownloadaCobaltStrikeBeacon: 

SeemoredetailedanalysisofthemaliciousdocumentsinourAttackLifeCycle 
section. 


FILELESS PAYLOAD DELIVERY INFRASTRUCTURE 

WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!
INFRASTRUCTURE 

Intherstphaseoftheattack,theattackersusedalelessin-memorypayload deliveryinfrastructureconsistingofthefollowingcomponents: 
1. VBS and PowerShell-basedloaders 
TheattackersdroppedVisualBasicandPowerShellscriptsinfoldersthatthey createdundertheProgramData(ahiddenfolder,bydefault).Theattackerscreated persistenceusingWindows’registry,servicesandscheduledtasks.Thispersistence mechanismensuredthattheloaderscriptswouldexecuteeitheratstartuporat predeterminedintervals. 
ValuesfoundinWindows’Registry:theVBSscriptsareexecutedbyWindows’ 

Wscriptatstartup: 

The.vbsscriptsaswellasthe.txtlescontaintheloader’sscript,whichlaunches PowerShellwithabase64encodedcommand,whicheitherloadsanother PowerShellscript(e.gCobaltStrikeBeacon)orfetchesapayloadfromthe command-and-control(C&C)server: 


2. In-memory leless payloads from C&C servers 
ThepayloadsservedbytheC&CserversaremostlyPowerShellscriptswith embeddedbase64-encodedpayloads(MetasploitandCobaltStrikepayloads): 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!Example 1: PowerShellpayload with embeddedShellcode downloading Cobalt Strike Beacon 

Thedecodedpayloadisashellcode,whosepurposeistoretrieveaCobaltStrike BeaconfromtheC&Cserver: 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!

Example 2: Cobalt Strike Beacon embeddedin obfuscated PowerShell 
AsecondtypeofanobfuscatedPowerShellpayloadconsistedofCobaltStrike’s Beaconpayload: 

Less than 48 hours after Cybereason alerted the company about the breach,theattackersstartedtochangetheirapproachandalmostcompletely 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!abandonedthePowerShellinfrastructurethattheyhadbeenusing-replacingit withsophisticatedcustom-builtbackdoors.Theattackers’remarkableabilityto quicklyadaptdemonstratedtheirskillandfamiliaritywithandcommandofthe company’snetworkanditsoperations. 
TheattackersmostlikelyreplacedthePowerShellinfrastructureafterthecompany usedbothWindowsGroupPolicyObject(GPO)andCybereason’sexecution preventionfeaturetopreventPowerShellexecution. 


PHASE TWO: BACKDOORS EXPLOITING DLL­HIJACKING AND USING DNS TUNNELING 
AfterrealizingthatthePowerShellinfrastructurehadbeendiscovered,the attackershadtoquicklyreplaceittomaintainpersistenceandcontinuethe operation.Replacingthisinfrastructurein48hourssuggeststhatthethreatactors werepreparedforsuchascenario. 
Duringthesecondphaseoftheattack,the attackers introduced two sophisticated backdoors that they attempted to deploy on selected targets. Theintroductionofthebackdoorsisakeyturningpointinthe investigationsinceitdemonstratedthethreatactor’sresourcefulnessandskill-set. 
At the time of the attack, 
these 
backdoors were undetected and 

undocumented byanysecurityvendor.Recently,Kasperskyresearchersidentied avariantofoneofthebackdoorsasBackdoor.Win32.Denis.Theattackershadto makesurethattheyremainedundetectedsothebackdoorsweredesignedtobeas stealthyaspossible.Toavoidbeingdiscovered,themalwareauthorsusedthese techniques: 
Backdoors exploiting DLL hijacking against trusted applications 
Thebackdoorexploitedavulnerabilitycalled“DLL 
hijacking”inorderto“hide”the malwareinsidetrustedsoftware.Thistechniqueexploitsasecurityvulnerability foundinlegitimatesoftware,whichallowstheattackerstoloadafakeDLLand executeitsmaliciouscode. 
PleaseseeananalysisofthebackdoorsintheAttacker’sArsenalsection. 
Theattackersexploitedthisvulnerabilityagainstthefollowingtrustedapplications: 
. Windows Search(vulnerable applications: searchindexer.exe /searchprotoclhost.exe) 
. Fake DLL:msfte.dll(638b7b0536217c8923e856f4138d9caff7eb309d) 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!. Google Update (d30e8c7543adbc801d675068530b57d75cabb13f) . Fake DLL:goopdate.dll(973b1ca8661be6651114edf29b10b31db4e218f7) 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!
. Kaspersky’s Avpia (691686839681adb345728806889925dc4eddb74e) . Fake DLL:product_info.dll(3cf4b44c9470fb5bd0c16996c4b2a338502a7517) 

Byexploitinglegitimatesoftware,theattackersbypassedapplicationwhitelisting andlegitimatesecuritysoftware,allowingthemtocontinuetheiroperationswithout ii ii 

raisinganysuspicions. 

DNSTunneling as C2 channel ­
Inattempttoovercomenetworklteringsolutions,theattackersimplementeda stealthierC2communicationmethod,using“DNSTunneling”–amethodofC2 communicatinganddataexltrationusingtheDNSprotocol.ToensurethattheDNS trafcwouldnotbeltered,theattackersconguredthebackdoortocommunicate withGoogleandOpenDNSDNSservers,sincemostorganizationsandsecurity productswillnotltertrafctothosetwomajorDNSservices. 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!
Thescreenshotbelowshowsthetrafcgeneratedbythebackdoorand demonstratesDNSTunnelingforC2communication.Asshown,whilethedestination IPis“8.8.8.8”–Google’sDNSserver–themaliciousdomainis“hiding”insidethe DNSpacket: 



PHASE THREE: NOVEL MS OUTLOOK BACKDOOR AND LATERAL MOVEMENT SPREE 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!Inthethirdphaseoftheoperation,theattackersharvestedcredentialsstoredon thecompromisedmachinesandperformedlateralmovementandinfectednew machines.Theattackersalsointroduced a very rare and stealthy technique tocommunicatewiththeirserversandexltratedatausingMicrosoft Outlook. 

OUTLOOK MACRO BACKDOOR 

I ll id dh kdid lh
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!Inarelentlessattempttoremainundetected,theattackersdevisedaverystealthy C2channelthatishardtodetectsinceitleveragesanemail-basedC2channel.The attackersinstalled a backdoor macro in Microsoft Outlook thatenabledthem toexecutecommands,deploytheirtoolsandstealvaluabledatafromthe compromisedmachines. 
ForadetailedanalysisoftheOutlookbackdoor,pleaseseetheAttacker’sArsenal 
section. 

Thistechniqueworksasfollows: 


1. 
Themaliciousmacroscansthevictim’sOutlookinboxandlooksforthestrings “$$cpte” and“$$ecpte”. 

2. 
ThenthemacrowillopenaCMDshellthatwillexecutewhateverinstruction/ commandisinbetweenthestrings. 

3. 
Themacrodeletesthemessagefrominboxtoensureminimalriskofexposure. 

4. 
Themacrosearchesforthespecialstringsinthe“DeletedItems”foldertond theattacker’semailaddressandsendsthedatabacktotheattackersviaemail. 

5. 
Lastly,themacrowilldeleteanyevidenceoftheemailsreceivedorsentbythe attackers. 



CREDENTIAL DUMPING AND LATERAL MOVEMENT 
TheattackersusedthefamousMimikatz 
credentialdumpingtoolastheirmain tooltoobtaincredentialsincludinguserpasswords,NTLMhashesandKerberos tickets.Mimikatzisaverypopulartoolandisdetectedbymostantivirusvendors andothersecurityproducts.Therefore,theattackersusedover10different customizedMimikatzpayloads,whichwereobfuscatedandpackedinawaythat allowedthemtoevadeantivirusdetection. 
Th fll i l fMi ik dli d ddiThefollowingareexamplesofMimikatzcommandlineargumentsdetectedduring theattack: 
ttttWebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!
Thestolencredentialswereusedtoinfectmoremachines,leveragingWindows built-intoolsaswellaspass-the-ticketandpass-the-hashattacks. 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!

PHASE FOUR: NEW ARSENAL AND ATTEMPT TO RESTORE POWERSHELL INFRASTRUCTURE 
Afterafourweeklullandnoapparentmaliciousactivity,theattackersreturnedto thesceneandintroducednewandimprovedtoolsaimedatbypassingthesecurity mitigationsthatwereimplementedbythecompany’sITteam.Thesetoolsand methodsmainly allowed them to bypass the PowerShell execution restrictions andpassworddumping mitigations. 
Duringthatphase,Cybereasonfoundacompromisedserverthatwasusedasthe mainattackingmachine,wheretheattackersstoredtheirarsenalinanetwork share,whichmadeiteasiertospreadtheirtoolstoothermachinesonthenetwork. Theattackers’arsenalconsisted: 
. New variants ofDenis andGoopy backdoors 
. PowerShell Restriction Bypass Tool-AdaptedfromPSUnlockGithub 
project. 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!
. PowerShell Cobalt Strike Beacon -Newpayload+newC2domain 
. PowerShell Obfuscator -AllthenewPowerShellpayloadsareobfuscated usingapubliclyavailablescriptadaptedfromaDanielBohannon’sGitHubproject. 
. HookPasswordChange -InspiredbytoolsfoundonGitHub,thistoolalertsthe attackersifapasswordhasbeenchanged.Usingthistool,theattackerscould overcomeapasswordreset.Theattackersmodiedtheirtool. 
. CustomizedWindows Credentials Dumper -APowerShellpassword dumperthatisbasedonaknownpassworddumpingtool,usingPowerShell bypassandreectiveloading.TheattackersspecicallyusedittoobtainOutlook passwords. 
. CustomizedOutlook Credentials Dumper -InspiredbyknownOutlook credentialsdumpers. 
. Mimikatz -PowerShellandBinaryversions,withmultiplelayersof obfuscation. 
PleaseseetheAttacker’sArsenalsectionfordetailedanalysisofthetools. 
Ananalysisofthisarsenalshowsthattheattackerswentoutoftheirwayto restorethePowerShell-basedinfrastructure,eventhoughithadalreadybeen detectedandshutdownonce.Theattackers’preferencetousealeless infrastructurespecicallyinconjunctionwithCobaltStrikeisveryevident.This couldsuggestthattheattackerspreferredtouseknowntoolsthataremore expendableratherthanusingtheirowncustom-builttools,whichwereusedasa lastresort. 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!

CONCLUSION 
OperationCobaltKittywasamajorcyberespionageAPTthattargetedaglobal corporationinAsiaandwascarriedoutbytheOceanLotusGroup.Theanalysisof thisAPTproveshowdeterminedandmotivatedtheattackerswere.They continuouslychangedtechniquesandupgradedtheirarsenaltoremainunderthe radar.Infact,theynevergaveup,evenwhentheattackwasexposedandshut downbythedefenders. 
DuringtheinvestigationofOperationCobaltKitty,Cybereasonuncoveredand analyzednewtoolsintheOceanLotusGroup’sattackarsenal,suchas: 
. Newbackdoor(“Goopy”)usingHTTPandDNSTunnelingforC2communication. 
. UndocumentedbackdoorthatusedOutlookforC2communicationanddata exltration. 
. BackdoorsexploitingDLLsideloadingattacksinlegitimateapplicationsfrom Microsoft,GoogleandKaspersky. 
. Threecustomizedcredentialdumpingtools,whichareinspiredbyknowntools. 
WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!Inaddition,Cybereasonuncoverednewvariantsofthe“Denis”backdoorand managedtoattributethebackdoortotheOceanLotusGroup-aconnectionthathad notbeenpubliclyreportedbefore. 
ThisreportprovidesararedeepdiveintoasophisticatedAPTthatwascarriedout byoneofthemostfascinatinggroupsoperatinginAsia.Theabilitytoclosely monitoranddetectthestagesofanentireAPTlifecycle-frominitialinltrationto dataexltration-isfarfromtrivial. 
Thefactthatmostoftheattackers’toolswerenotdetectedbytheantivirus softwareandothersecurityproductsdeployedinthecompany’senvironmentbefore Cybereason,isnotsurprising.Theattackersobviouslyinvestedsignicanttimeand effortinkeepingtheoperationundetected,strivingtoevadeantivirusdetection. 
Astheinvestigationprogressed,someoftheIOCsobservedinOperationCobalt Kittystartedtoemergeinthewild,andrecentlysomewereevenreportedbeing usedinothercampaigns.Itisimportanttoremember,however,thatIOCshavea tendencytochangeovertime.Therefore,understandingathreatactor’sbehavioral patternsisessentialincombattingmodernandsophisticatedAPTs.Themodus operandiandtoolsservedasbehavioralngerprintsalsoplayedanimportantrole intyingOperationCobaltKittytotheOceanLotusGroup. 
Lastly,ourresearchprovidesanimportanttestimonytothecapabilitiesand workingmethodsoftheOceanLotusGroup.OperationCobaltKittyisuniqueinmany ways,nonetheless,itisstilljustonelinkinthegroup’sever-growingchainofAPT campaigns.OrchestratingmultipleAPTcampaignsinparallelandattackingabroad spectrumoftargetstakesanincredibleamountofresources,time,manpowerand motivation.Thiscombinationislikelytobemorecommonamongnation-state actors.WhilethearemanyrumoursandspeculationscirculatingintheInfoSec community,atthetimeofwriting,therewasnopubliclyavailableevidencethatcan conrmthattheOceanLotusGroupisanation-statethreatactor. 

Untilsuchevidenceismadepublic,wewillleaveittoourreaderstojudgefor themselves. 
Tobecontinued...Meow. 



READ 
READ 
READ 
MORE 

MORE 

MORE 

Return 
to 
Blog 

SUBSCRIBEFORUPDATESSHAREContactBlogPodcast.......WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!PRODUCTS  SERVICES  PLATFORM  COMPANY  INSIGHTS 
 RANSOMFREE  
Deep 
Detect 
& 
Respond 
Deep 
Prevent 
Deep 
Investigate 
Deep 
Respond 
RansomFree 
Demos 
 Deep 
Monitoring 
Deep 
Hunting 
Deep 
Incident 
Response 
Customer 
Service 
& 
Success 
 How 
It 
Works 
Deep 
Behavioral 
Intel 
Engine 
Deep 
Sensor 
Architecture 
Complete 
Security 
Visibility 
Full 
Theater 
View 
Compliance 
& 
Certication 
 Who 
We 
Are 
Careers 
Management 
Newsroom 
Awards 
Contact 
Us 
PARTNER 
 Webinars 
Videos 
White 
Papers 
Research 
Quick 
Reads 
 Free 
ransomware 
protection 
for 
your 
PC 
 
Become 
a 
Partner 
 
are  "Cybereason” and proprietary trademarks of ®  Cybereason Inc.  Cybereason  
is  federally registered  in the  United  States  and  other  countries  
Copyright  ©  2018  Cybereason Inc.  All  rights  reserved.  
Terms 
 of  Use  |  Privacy 
Policy 
 

WebpageconvertedtoPDFwiththePDFmyURLPDFcreationAPI!

